Feature: Login- App Token # features/Login/1_appToken.feature:1
  As a merchant
  I want to get an app token from Sasai Payment Gateway API
  So that I can authenticate and access payment services
  Background:   # features/Login/1_appToken.feature:6

  @smoke @appToken @sasai
  Scenario: Get app token with valid credentials     # features/Login/1_appToken.feature:10
    Given API is available                           # steps/common_steps.py:9
    Given I have valid Sasai login credentials       # steps/appToken_steps.py:21
    When I send POST request to "/bff/v1/auth/token" # steps/common_steps.py:28
    Then response status code should be 200          # steps/common_steps.py:116
    And response body should contain "accessToken"   # steps/common_steps.py:132
    And I store the "accessToken" from response      # steps/common_steps.py:176

  @appToken @positive @sasai
  Scenario: Get app token with Sasai credentials     # features/Login/1_appToken.feature:18
    Given API is available                           # steps/common_steps.py:9
    Given I have Sasai credentials                   # steps/appToken_steps.py:34
    When I send POST request to "/bff/v1/auth/token" # steps/common_steps.py:28
    Then response status code should be 200          # steps/common_steps.py:116
    And response body should contain "accessToken"   # steps/common_steps.py:132
    And response time should be less than 5000 ms    # steps/common_steps.py:169

  @appToken @negative @sasai
  Scenario: Get app token with invalid credentials   # features/Login/1_appToken.feature:26
    Given API is available                           # steps/common_steps.py:9
    Given I have invalid Sasai credentials           # steps/appToken_steps.py:47
    When I send POST request to "/bff/v1/auth/token" # steps/common_steps.py:28
    Then response status code should be 400          # steps/common_steps.py:116

  @appToken @negative @sasai
  Scenario: Get app token with missing tenantId      # features/Login/1_appToken.feature:32
    Given API is available                           # steps/common_steps.py:9
    Given I have Sasai credentials without tenantId  # steps/appToken_steps.py:59
    When I send POST request to "/bff/v1/auth/token" # steps/common_steps.py:28
    Then response status code should be 400          # steps/common_steps.py:116

  @appToken @negative @sasai
  Scenario: Get app token with missing clientId      # features/Login/1_appToken.feature:38
    Given API is available                           # steps/common_steps.py:9
    Given I have Sasai credentials without clientId  # steps/appToken_steps.py:71
    When I send POST request to "/bff/v1/auth/token" # steps/common_steps.py:28
    Then response status code should be 400          # steps/common_steps.py:116

  @appToken @validation @sasai
  Scenario: Validate app token response structure        # features/Login/1_appToken.feature:44
    Given API is available                               # steps/common_steps.py:9
    Given I have valid Sasai login credentials           # steps/appToken_steps.py:21
    When I send POST request to "/bff/v1/auth/token"     # steps/common_steps.py:28
    Then response status code should be 200              # steps/common_steps.py:116
    And response body should contain "accessToken"       # steps/common_steps.py:132
    And response field "accessToken" should not be empty # steps/common_steps.py:157

  @appToken @headers @validation @sasai
  Scenario: Verify app token response headers                            # features/Login/1_appToken.feature:52
    Given API is available                                               # steps/common_steps.py:9
    Given I have valid Sasai login credentials                           # steps/appToken_steps.py:21
    When I send POST request to "/bff/v1/auth/token"                     # steps/common_steps.py:28
    Then response status code should be 200                              # steps/common_steps.py:116
    And response header "Content-Type" should be present                 # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json" # steps/common_steps.py:229

  @appToken @headers @validation @sasai
  Scenario: Verify app token response has required headers  # features/Login/1_appToken.feature:60
    Given API is available                                  # steps/common_steps.py:9
    Given I have valid Sasai login credentials              # steps/appToken_steps.py:21
    When I send POST request to "/bff/v1/auth/token"        # steps/common_steps.py:28
    Then response status code should be 200                 # steps/common_steps.py:116
    And response header "Content-Type" should not be empty  # steps/common_steps.py:243
    And response header "Date" should be present            # steps/common_steps.py:206

  @appToken @headers @security @sasai
  Scenario: Verify app token security headers                # features/Login/1_appToken.feature:68
    Given API is available                                   # steps/common_steps.py:9
    Given I have valid Sasai login credentials               # steps/appToken_steps.py:21
    When I send POST request to "/bff/v1/auth/token"         # steps/common_steps.py:28
    Then response status code should be 200                  # steps/common_steps.py:116
    And response header "Content-Type" should contain "json" # steps/common_steps.py:229

Feature: Login- OTP Request # features/Login/2_otpRequest.feature:1
  As a merchant
  I want to request OTP from Sasai Payment Gateway API
  So that I can verify user identity for secure transactions
  Background:   # features/Login/2_otpRequest.feature:6

  @smoke @otp @sasai
  Scenario: Request OTP with valid parameters                            # features/Login/2_otpRequest.feature:11
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have valid OTP request details                               # steps/otp_steps.py:38
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 200                              # steps/common_steps.py:116
    And response time should be less than 5000 ms                        # steps/common_steps.py:169

  @otp @positive @sasai
  Scenario: Request OTP with SMS mode                                    # features/Login/2_otpRequest.feature:18
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have OTP request with sender ID "771222221"                  # steps/otp_steps.py:51
    And I have country code "+263"                                       # steps/otp_steps.py:60
    And I have OTP purpose "0"                                           # steps/otp_steps.py:69
    And I have OTP mode "0"                                              # steps/otp_steps.py:78
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 200                              # steps/common_steps.py:116

  @otp @negative @sasai
  Scenario: Request OTP without authentication             # features/Login/2_otpRequest.feature:27
    Given API is available                                 # steps/common_steps.py:9
    And I am authenticated with valid app token            # steps/otp_steps.py:9
    Given I have valid OTP request details                 # steps/otp_steps.py:38
    When I send POST request to "/bff/v2/auth/otp/request" # steps/common_steps.py:28
    Then response status code should be 401                # steps/common_steps.py:116

  @otp @negative @sasai
  Scenario: Request OTP with invalid sender ID                           # features/Login/2_otpRequest.feature:33
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have OTP request with sender ID "invalid"                    # steps/otp_steps.py:51
    And I have country code "+263"                                       # steps/otp_steps.py:60
    And I have OTP purpose "0"                                           # steps/otp_steps.py:69
    And I have OTP mode "0"                                              # steps/otp_steps.py:78
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 400                              # steps/common_steps.py:116

  @otp @negative @sasai
  Scenario: Request OTP with missing sender ID                           # features/Login/2_otpRequest.feature:42
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have OTP request without sender ID                           # steps/otp_steps.py:87
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 400                              # steps/common_steps.py:116

  @otp @negative @sasai
  Scenario: Request OTP with invalid country code                        # features/Login/2_otpRequest.feature:48
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have OTP request with sender ID "771222221"                  # steps/otp_steps.py:51
    And I have country code "invalid"                                    # steps/otp_steps.py:60
    And I have OTP purpose "0"                                           # steps/otp_steps.py:69
    And I have OTP mode "0"                                              # steps/otp_steps.py:78
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 400                              # steps/common_steps.py:116

  @otp @validation @sasai
  Scenario: Verify OTP request response structure                        # features/Login/2_otpRequest.feature:57
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have valid OTP request details                               # steps/otp_steps.py:38
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 200                              # steps/common_steps.py:116
    And response body should contain "otpReferenceId"                    # steps/common_steps.py:132
    And response body should contain "userReferenceId"                   # steps/common_steps.py:132

  @otp @headers @validation @sasai
  Scenario: Verify OTP request response headers                          # features/Login/2_otpRequest.feature:65
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have valid OTP request details                               # steps/otp_steps.py:38
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 200                              # steps/common_steps.py:116
    And response header "Content-Type" should be present                 # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json" # steps/common_steps.py:229

  @otp @headers @validation @sasai
  Scenario: Verify OTP request has required headers                      # features/Login/2_otpRequest.feature:73
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have valid OTP request details                               # steps/otp_steps.py:38
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 200                              # steps/common_steps.py:116
    And response header "Content-Type" should not be empty               # steps/common_steps.py:243
    And response header "Date" should be present                         # steps/common_steps.py:206

  @otp @headers @security @sasai
  Scenario: Verify OTP request security headers                          # features/Login/2_otpRequest.feature:81
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have valid OTP request details                               # steps/otp_steps.py:38
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 200                              # steps/common_steps.py:116
    And response header "Content-Type" should contain "json"             # steps/common_steps.py:229

  @otp @security @sasai
  Scenario: Request OTP with expired token                               # features/Login/2_otpRequest.feature:88
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have expired authentication token                            # steps/otp_steps.py:98
    And I have valid OTP request details                                 # steps/otp_steps.py:38
    When I send authenticated POST request to "/bff/v2/auth/otp/request" # steps/otp_steps.py:105
    Then response status code should be 401                              # steps/common_steps.py:116

Feature: Login- OTP Verify # features/Login/3_otpVerify.feature:1
  As a merchant
  I want to verify OTP from Sasai Payment Gateway API
  So that I can complete user authentication for secure transactions
  Background:   # features/Login/3_otpVerify.feature:6

  @smoke @otp_verify @sasai
  Scenario: Verify OTP with valid parameters                          # features/Login/3_otpVerify.feature:11
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have valid OTP verification details                       # steps/otp_verify_steps.py:10
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 200                           # steps/common_steps.py:116
    And response time should be less than 5000 ms                     # steps/common_steps.py:169
    And response should contain OTP verification status               # steps/otp_verify_steps.py:234

  @otp_verify @positive @sasai
  Scenario: Verify OTP with correct OTP code                          # features/Login/3_otpVerify.feature:19
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have OTP reference ID from previous request               # steps/otp_verify_steps.py:57
    And I have valid OTP code "123456"                                # steps/otp_verify_steps.py:96
    And I have user reference ID                                      # steps/otp_verify_steps.py:105
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 200                           # steps/common_steps.py:116
    And OTP verification should be successful                         # steps/otp_verify_steps.py:246

  @otp_verify @negative @sasai
  Scenario: Verify OTP without authentication             # features/Login/3_otpVerify.feature:28
    Given API is available                                # steps/common_steps.py:9
    And I am authenticated with valid app token           # steps/otp_steps.py:9
    Given I have valid OTP verification details           # steps/otp_verify_steps.py:10
    When I send POST request to "/bff/v1/auth/otp/verify" # steps/common_steps.py:28
    Then response status code should be 401               # steps/common_steps.py:116

  @otp_verify @negative @sasai
  Scenario: Verify OTP with invalid OTP code                          # features/Login/3_otpVerify.feature:34
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have OTP reference ID from previous request               # steps/otp_verify_steps.py:57
    And I have invalid OTP code "000000"                              # steps/otp_verify_steps.py:144
    And I have user reference ID                                      # steps/otp_verify_steps.py:105
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 400                           # steps/common_steps.py:116

  @otp_verify @negative @sasai
  Scenario: Verify OTP with expired OTP reference                     # features/Login/3_otpVerify.feature:42
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have expired OTP reference ID                             # steps/otp_verify_steps.py:153
    And I have valid OTP code "123456"                                # steps/otp_verify_steps.py:96
    And I have user reference ID                                      # steps/otp_verify_steps.py:105
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 400                           # steps/common_steps.py:116

  @otp_verify @negative @sasai
  Scenario: Verify OTP with missing OTP reference ID                  # features/Login/3_otpVerify.feature:50
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have OTP verification without reference ID                # steps/otp_verify_steps.py:164
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 400                           # steps/common_steps.py:116

  @otp_verify @negative @sasai
  Scenario: Verify OTP with missing OTP code                          # features/Login/3_otpVerify.feature:56
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have OTP reference ID from previous request               # steps/otp_verify_steps.py:57
    And I have user reference ID                                      # steps/otp_verify_steps.py:105
    And I have OTP verification without OTP code                      # steps/otp_verify_steps.py:174
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 400                           # steps/common_steps.py:116

  @otp_verify @negative @sasai
  Scenario: Verify OTP with invalid user reference ID                 # features/Login/3_otpVerify.feature:64
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have OTP reference ID from previous request               # steps/otp_verify_steps.py:57
    And I have valid OTP code "123456"                                # steps/otp_verify_steps.py:96
    And I have invalid user reference ID                              # steps/otp_verify_steps.py:184
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 400                           # steps/common_steps.py:116

  @otp_verify @validation @sasai
  Scenario: Verify OTP response structure                             # features/Login/3_otpVerify.feature:72
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have valid OTP verification details                       # steps/otp_verify_steps.py:10
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 200                           # steps/common_steps.py:116
    And response body should be valid JSON                            # steps/common_steps.py:139
    And response should contain verification status                   # steps/otp_verify_steps.py:268

  @otp_verify @headers @validation @sasai
  Scenario: Verify OTP verification response headers                     # features/Login/3_otpVerify.feature:80
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have valid OTP verification details                          # steps/otp_verify_steps.py:10
    When I send OTP verification request to "/bff/v1/auth/otp/verify"    # steps/otp_verify_steps.py:212
    Then response status code should be 200                              # steps/common_steps.py:116
    And response header "Content-Type" should be present                 # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json" # steps/common_steps.py:229

  @otp_verify @headers @validation @sasai
  Scenario: Verify OTP verification has required headers              # features/Login/3_otpVerify.feature:88
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have valid OTP verification details                       # steps/otp_verify_steps.py:10
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 200                           # steps/common_steps.py:116
    And response header "Content-Type" should not be empty            # steps/common_steps.py:243
    And response header "Date" should be present                      # steps/common_steps.py:206

  @otp_verify @headers @security @sasai
  Scenario: Verify OTP verification security headers                  # features/Login/3_otpVerify.feature:96
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have valid OTP verification details                       # steps/otp_verify_steps.py:10
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 200                           # steps/common_steps.py:116
    And response header "Content-Type" should contain "json"          # steps/common_steps.py:229

  @otp_verify @security @sasai
  Scenario: Verify OTP with expired authentication token              # features/Login/3_otpVerify.feature:103
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have expired authentication token                         # steps/otp_steps.py:98
    And I have valid OTP verification details                         # steps/otp_verify_steps.py:10
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 401                           # steps/common_steps.py:116

  @otp_verify @security @sasai
  Scenario: Verify OTP with invalid Bearer token                      # features/Login/3_otpVerify.feature:110
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have invalid authentication token                         # steps/otp_verify_steps.py:194
    And I have valid OTP verification details                         # steps/otp_verify_steps.py:10
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 401                           # steps/common_steps.py:116

  @otp_verify @negative @sasai
  Scenario: Verify OTP with malformed request body                    # features/Login/3_otpVerify.feature:117
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have malformed OTP verification data                      # steps/otp_verify_steps.py:201
    When I send OTP verification request to "/bff/v1/auth/otp/verify" # steps/otp_verify_steps.py:212
    Then response status code should be 400                           # steps/common_steps.py:116

Feature: Login- PIN Verify # features/Login/4_pinVerify.feature:1
  As a merchant
  I want to verify PIN from Sasai Payment Gateway API
  So that I can authenticate users securely for transactions
  Background:   # features/Login/4_pinVerify.feature:9

  @smoke @pin_verify @sasai
  Scenario: Verify PIN with valid parameters                          # features/Login/4_pinVerify.feature:14
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have valid PIN verification details                       # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 200                           # steps/common_steps.py:116
    And response time should be less than 5000 ms                     # steps/common_steps.py:169
    And response should contain PIN verification status               # steps/pin_verify_steps.py:290

  @pin_verify @positive @sasai
  Scenario: Verify PIN with correct encrypted PIN                     # features/Login/4_pinVerify.feature:22
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have encrypted PIN                                        # steps/pin_verify_steps.py:71
    And I have user reference ID for PIN                              # steps/pin_verify_steps.py:82
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 200                           # steps/common_steps.py:116
    And PIN verification should be successful                         # steps/pin_verify_steps.py:303

  @pin_verify @positive @sasai
  Scenario: Verify PIN with query parameters                                            # features/Login/4_pinVerify.feature:30
    Given API is available                                                              # steps/common_steps.py:9
    And I am authenticated with valid app token                                         # steps/otp_steps.py:9
    Given I have valid PIN verification details                                         # steps/pin_verify_steps.py:10
    And I have tenant ID "sasai"                                                        # steps/pin_verify_steps.py:97
    And I have azp "sasai-pay-client"                                                   # steps/pin_verify_steps.py:106
    When I send PIN verification request with query params to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:255
    Then response status code should be 200                                             # steps/common_steps.py:116
    And response should contain PIN verification status                                 # steps/pin_verify_steps.py:290

  @pin_verify @negative @sasai
  Scenario: Verify PIN without authentication             # features/Login/4_pinVerify.feature:39
    Given API is available                                # steps/common_steps.py:9
    And I am authenticated with valid app token           # steps/otp_steps.py:9
    Given I have valid PIN verification details           # steps/pin_verify_steps.py:10
    When I send POST request to "/bff/v4/auth/pin/verify" # steps/common_steps.py:28
    Then response status code should be 400               # steps/common_steps.py:116

  @pin_verify @negative @sasai
  Scenario: Verify PIN with invalid encrypted PIN                     # features/Login/4_pinVerify.feature:45
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have invalid encrypted PIN                                # steps/pin_verify_steps.py:124
    And I have user reference ID for PIN                              # steps/pin_verify_steps.py:82
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 400                           # steps/common_steps.py:116

  @pin_verify @negative @sasai
  Scenario: Verify PIN with missing PIN field                         # features/Login/4_pinVerify.feature:52
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have PIN verification without PIN                         # steps/pin_verify_steps.py:144
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 400                           # steps/common_steps.py:116

  @pin_verify @negative @sasai
  Scenario: Verify PIN with missing user reference ID                 # features/Login/4_pinVerify.feature:58
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have encrypted PIN                                        # steps/pin_verify_steps.py:71
    And I have PIN verification without user reference ID             # steps/pin_verify_steps.py:154
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 400                           # steps/common_steps.py:116

  @pin_verify @negative @sasai
  Scenario: Verify PIN with invalid user reference ID                 # features/Login/4_pinVerify.feature:65
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have encrypted PIN                                        # steps/pin_verify_steps.py:71
    And I have invalid user reference ID for PIN                      # steps/pin_verify_steps.py:164
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 400                           # steps/common_steps.py:116

  @pin_verify @negative @sasai
  Scenario: Verify PIN with empty PIN                                 # features/Login/4_pinVerify.feature:72
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have empty PIN                                            # steps/pin_verify_steps.py:134
    And I have user reference ID for PIN                              # steps/pin_verify_steps.py:82
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 400                           # steps/common_steps.py:116

  @pin_verify @negative @sasai
  Scenario: Verify PIN with invalid tenant ID                                           # features/Login/4_pinVerify.feature:79
    Given API is available                                                              # steps/common_steps.py:9
    And I am authenticated with valid app token                                         # steps/otp_steps.py:9
    Given I have valid PIN verification details                                         # steps/pin_verify_steps.py:10
    And I have invalid tenant ID "invalid-tenant"                                       # steps/pin_verify_steps.py:115
    When I send PIN verification request with query params to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:255
    Then response status code should be 400                                             # steps/common_steps.py:116

  @pin_verify @negative @sasai
  Scenario: Verify PIN with missing model header                                           # features/Login/4_pinVerify.feature:86
    Given API is available                                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                                            # steps/otp_steps.py:9
    Given I have valid PIN verification details                                            # steps/pin_verify_steps.py:10
    When I send PIN verification request without model header to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:261
    Then response status code should be 400                                                # steps/common_steps.py:116

  @pin_verify @validation @sasai
  Scenario: Verify PIN response structure                             # features/Login/4_pinVerify.feature:92
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have valid PIN verification details                       # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 200                           # steps/common_steps.py:116
    And response body should be valid JSON                            # steps/common_steps.py:139
    And response should contain verification status                   # steps/otp_verify_steps.py:268

  @pin_verify @headers @validation @sasai
  Scenario: Verify PIN verification response headers                     # features/Login/4_pinVerify.feature:100
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    Given I have valid PIN verification details                          # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"    # steps/pin_verify_steps.py:222
    Then response status code should be 200                              # steps/common_steps.py:116
    And response header "Content-Type" should be present                 # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json" # steps/common_steps.py:229

  @pin_verify @headers @validation @sasai
  Scenario: Verify PIN verification has required headers              # features/Login/4_pinVerify.feature:108
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have valid PIN verification details                       # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 200                           # steps/common_steps.py:116
    And response header "Content-Type" should not be empty            # steps/common_steps.py:243
    And response header "Date" should be present                      # steps/common_steps.py:206

  @pin_verify @headers @security @sasai
  Scenario: Verify PIN verification security headers                  # features/Login/4_pinVerify.feature:116
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have valid PIN verification details                       # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 200                           # steps/common_steps.py:116
    And response header "Content-Type" should contain "json"          # steps/common_steps.py:229

  @pin_verify @security @sasai
  Scenario: Verify PIN with expired authentication token              # features/Login/4_pinVerify.feature:123
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have expired authentication token                         # steps/otp_steps.py:98
    And I have valid PIN verification details                         # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 401                           # steps/common_steps.py:116

  @pin_verify @security @sasai
  Scenario: Verify PIN with invalid Bearer token                      # features/Login/4_pinVerify.feature:130
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have invalid authentication token                         # steps/otp_verify_steps.py:194
    And I have valid PIN verification details                         # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 401                           # steps/common_steps.py:116

  @pin_verify @negative @sasai
  Scenario: Verify PIN with malformed request body                    # features/Login/4_pinVerify.feature:137
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have malformed PIN verification data                      # steps/pin_verify_steps.py:210
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 400                           # steps/common_steps.py:116

  @pin_verify @security @sasai
  Scenario: Verify PIN with wrong device model                        # features/Login/4_pinVerify.feature:143
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    Given I have valid PIN verification details                       # steps/pin_verify_steps.py:10
    And I have invalid device model "HackerDevice"                    # steps/pin_verify_steps.py:174
    When I send PIN verification request to "/bff/v4/auth/pin/verify" # steps/pin_verify_steps.py:222
    Then response status code should be 400 or 403                    # steps/common_steps.py:123

Feature: Login Devices # features/Login_devices/5_loginDevices.feature:1
  As a user
  I want to retrieve my login devices from Sasai Payment Gateway API
  So that I can view all devices where I'm logged in
  Background:   # features/Login_devices/5_loginDevices.feature:9

  @smoke @login_devices @sasai
  Scenario: Get login devices with valid user token                   # features/Login_devices/5_loginDevices.feature:15
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have valid user authentication                            # steps/login_devices_steps.py:92
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 200                           # steps/common_steps.py:116
    And response time should be less than 5000 ms                     # steps/common_steps.py:169
    And response should contain login devices list                    # steps/login_devices_steps.py:205

  @login_devices @positive @sasai
  Scenario: Get login devices returns array                           # features/Login_devices/5_loginDevices.feature:23
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have valid user authentication                            # steps/login_devices_steps.py:92
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 200                           # steps/common_steps.py:116
    And response body should be valid JSON                            # steps/common_steps.py:139
    And response should be a list                                     # steps/login_devices_steps.py:223

  @login_devices @positive @sasai
  Scenario: Get login devices with valid Bearer token                 # features/Login_devices/5_loginDevices.feature:31
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have valid user authentication                            # steps/login_devices_steps.py:92
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 200                           # steps/common_steps.py:116
    And response should contain login devices list                    # steps/login_devices_steps.py:205

  @login_devices @negative @sasai
  Scenario: Get login devices without authentication                  # features/Login_devices/5_loginDevices.feature:38
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have no authentication token                              # steps/login_devices_steps.py:100
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 401                           # steps/common_steps.py:116

  @login_devices @negative @sasai
  Scenario: Get login devices with app token instead of user token    # features/Login_devices/5_loginDevices.feature:44
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have app token only                                       # steps/login_devices_steps.py:108
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 401 or 403                    # steps/common_steps.py:123

  @login_devices @negative @sasai
  Scenario: Get login devices with expired user token                 # features/Login_devices/5_loginDevices.feature:50
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have expired user token                                   # steps/login_devices_steps.py:115
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 401                           # steps/common_steps.py:116

  @login_devices @negative @sasai
  Scenario: Get login devices with invalid user token                 # features/Login_devices/5_loginDevices.feature:56
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have invalid user token                                   # steps/login_devices_steps.py:123
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 401                           # steps/common_steps.py:116

  @login_devices @negative @sasai
  Scenario: Get login devices with malformed Bearer token             # features/Login_devices/5_loginDevices.feature:62
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                               # steps/login_devices_steps.py:131
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 401                           # steps/common_steps.py:116

  @login_devices @validation @sasai
  Scenario: Verify login devices response structure                   # features/Login_devices/5_loginDevices.feature:68
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have valid user authentication                            # steps/login_devices_steps.py:92
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 200                           # steps/common_steps.py:116
    And response body should be valid JSON                            # steps/common_steps.py:139
    And response should be a list                                     # steps/login_devices_steps.py:223

  @login_devices @validation @sasai
  Scenario: Verify login devices response contains device information  # features/Login_devices/5_loginDevices.feature:76
    Given API is available                                             # steps/common_steps.py:9
    And I am authenticated with valid app token                        # steps/otp_steps.py:9
    And I have valid user token from PIN verification                  # steps/login_devices_steps.py:9
    Given I have valid user authentication                             # steps/login_devices_steps.py:92
    When I send login devices request to "/bff/v1/user/login-devices"  # steps/login_devices_steps.py:165
    Then response status code should be 200                            # steps/common_steps.py:116
    And each device should have required fields                        # steps/login_devices_steps.py:232

  @login_devices @headers @validation @sasai
  Scenario: Verify login devices response headers                        # features/Login_devices/5_loginDevices.feature:83
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                               # steps/login_devices_steps.py:92
    When I send login devices request to "/bff/v1/user/login-devices"    # steps/login_devices_steps.py:165
    Then response status code should be 200                              # steps/common_steps.py:116
    And response header "Content-Type" should be present                 # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json" # steps/common_steps.py:229

  @login_devices @headers @validation @sasai
  Scenario: Verify login devices has required headers                 # features/Login_devices/5_loginDevices.feature:91
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have valid user authentication                            # steps/login_devices_steps.py:92
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 200                           # steps/common_steps.py:116
    And response header "Content-Type" should not be empty            # steps/common_steps.py:243
    And response header "Date" should be present                      # steps/common_steps.py:206

  @login_devices @headers @security @sasai
  Scenario: Verify login devices security headers                     # features/Login_devices/5_loginDevices.feature:99
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have valid user authentication                            # steps/login_devices_steps.py:92
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 200                           # steps/common_steps.py:116
    And response header "Content-Type" should contain "json"          # steps/common_steps.py:229

  @login_devices @security @sasai
  Scenario: Get login devices with missing Authorization header       # features/Login_devices/5_loginDevices.feature:106
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have no Authorization header                              # steps/login_devices_steps.py:139
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 401                           # steps/common_steps.py:116

  @login_devices @security @sasai
  Scenario: Get login devices with empty Bearer token                 # features/Login_devices/5_loginDevices.feature:112
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                   # steps/login_devices_steps.py:146
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 401                           # steps/common_steps.py:116

  @login_devices @security @sasai
  Scenario: Get login devices without Bearer prefix                   # features/Login_devices/5_loginDevices.feature:118
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have token without Bearer prefix                          # steps/login_devices_steps.py:154
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 401                           # steps/common_steps.py:116

  @login_devices @error_handling @sasai
  Scenario: Get login devices with invalid HTTP method       # features/Login_devices/5_loginDevices.feature:124
    Given API is available                                   # steps/common_steps.py:9
    And I am authenticated with valid app token              # steps/otp_steps.py:9
    And I have valid user token from PIN verification        # steps/login_devices_steps.py:9
    Given I have valid user authentication                   # steps/login_devices_steps.py:92
    When I send POST request to "/bff/v1/user/login-devices" # steps/common_steps.py:28
    Then response status code should be 404                  # steps/common_steps.py:116

  @login_devices @error_handling @sasai
  Scenario: Get login devices with wrong endpoint          # features/Login_devices/5_loginDevices.feature:130
    Given API is available                                 # steps/common_steps.py:9
    And I am authenticated with valid app token            # steps/otp_steps.py:9
    And I have valid user token from PIN verification      # steps/login_devices_steps.py:9
    Given I have valid user authentication                 # steps/login_devices_steps.py:92
    When I send GET request to "/bff/v1/user/login-device" # steps/common_steps.py:50
    Then response status code should be 404                # steps/common_steps.py:116

  @login_devices @performance @sasai
  Scenario: Verify login devices response time                        # features/Login_devices/5_loginDevices.feature:136
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have valid user authentication                            # steps/login_devices_steps.py:92
    When I send login devices request to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:165
    Then response status code should be 200                           # steps/common_steps.py:116
    And response time should be less than 3000 ms                     # steps/common_steps.py:169

  @login_devices @integration @sasai
  Scenario: Complete flow - PIN Verify to Login Devices                                 # features/Login_devices/5_loginDevices.feature:143
    Given API is available                                                              # steps/common_steps.py:9
    And I am authenticated with valid app token                                         # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                   # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                         # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                   # steps/pin_verify_steps.py:222
    Then response status code should be 200                                             # steps/common_steps.py:116
    And I store the user token from response                                            # steps/login_devices_steps.py:260
    When I send login devices request with stored token to "/bff/v1/user/login-devices" # steps/login_devices_steps.py:196
    Then response status code should be 200                                             # steps/common_steps.py:116
    And response should contain login devices list                                      # steps/login_devices_steps.py:205

Feature: Church Search by Name # features/pay_to_church/14_churchSearch.feature:1
  As a user
  I want to search for churches by name
  So that I can find churches for making donations or payments
  Background:   # features/pay_to_church/14_churchSearch.feature:11

  @smoke @church_search @pay_to_church @sasai
  Scenario: Search churches with valid query                                             # features/pay_to_church/14_churchSearch.feature:17
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152
    And response should have church list                                                 # steps/church_search_steps.py:110

  @church_search @positive @pay_to_church @sasai
  Scenario: Search churches returns correct structure                                    # features/pay_to_church/14_churchSearch.feature:29
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response body should be valid JSON                                               # steps/common_steps.py:139
    And response should have pagination structure                                        # steps/church_search_steps.py:128

  @church_search @positive @pay_to_church @sasai
  Scenario: Search churches with specific name                                           # features/pay_to_church/14_churchSearch.feature:41
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "baptist"                                                      # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152

  @church_search @positive @pay_to_church @sasai
  Scenario: Search churches with different page size                                     # features/pay_to_church/14_churchSearch.feature:52
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 20                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152

  @church_search @positive @pay_to_church @sasai
  Scenario: Search churches with pagination                                              # features/pay_to_church/14_churchSearch.feature:63
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 1                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should have pagination info                                             # steps/church_search_steps.py:143

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches without authentication                                       # features/pay_to_church/14_churchSearch.feature:74
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have no authentication token                                                 # steps/login_devices_steps.py:100
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 401                                              # steps/common_steps.py:116

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches with invalid user token                                      # features/pay_to_church/14_churchSearch.feature:84
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have invalid user token                                                      # steps/login_devices_steps.py:123
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 401                                              # steps/common_steps.py:116

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches with expired user token                                      # features/pay_to_church/14_churchSearch.feature:94
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have expired user token                                                      # steps/login_devices_steps.py:115
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 401                                              # steps/common_steps.py:116

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches with app token instead of user token                         # features/pay_to_church/14_churchSearch.feature:104
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have app token only                                                          # steps/login_devices_steps.py:108
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 401 or 403                                       # steps/common_steps.py:123

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches without type parameter                                       # features/pay_to_church/14_churchSearch.feature:114
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have no search type                                                            # steps/school_search_steps.py:49
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 400                                              # steps/common_steps.py:116

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches with invalid type                                            # features/pay_to_church/14_churchSearch.feature:124
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "INVALID"                                                     # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 400                                              # steps/common_steps.py:116

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches without name query                                           # features/pay_to_church/14_churchSearch.feature:134
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have no name query                                                             # steps/church_search_steps.py:33
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 400                                              # steps/common_steps.py:116

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches with empty name query                                        # features/pay_to_church/14_churchSearch.feature:144
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query ""/bff/v1/catalog/search-school-church-merchant                                                             # steps/church_search_steps.py:46
    When I send church search request to400bff/v1/catalog/search-school-church-merchant" # steps/common_steps.py:116
    Then response status code should be 400                                              # None

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches with negative page number                                    # features/pay_to_church/14_churchSearch.feature:154
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number -1                                                            # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 400                                              # steps/common_steps.py:116

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches with zero page size                                          # features/pay_to_church/14_churchSearch.feature:164
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 0                                                               # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 400                                              # steps/common_steps.py:116

  @church_search @negative @pay_to_church @sasai
  Scenario: Search churches with excessive page size                                     # features/pay_to_church/14_churchSearch.feature:174
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 1000                                                            # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 400                                              # steps/common_steps.py:116

  @church_search @validation @pay_to_church @sasai
  Scenario: Verify church search response contains required fields                       # features/pay_to_church/14_churchSearch.feature:184
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should have content field                                               # steps/church_search_steps.py:158
    And response should have pagination fields                                           # steps/church_search_steps.py:172

  @church_search @validation @pay_to_church @sasai
  Scenario: Verify church search response structure                                      # features/pay_to_church/14_churchSearch.feature:196
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response body should be valid JSON                                               # steps/common_steps.py:139
    And response should have search structure                                            # steps/church_search_steps.py:187

  @church_search @validation @pay_to_church @sasai
  Scenario: Verify church items have required fields                                     # features/pay_to_church/14_churchSearch.feature:208
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And each church should have name field                                               # steps/church_search_steps.py:275
    And each church should have code field                                               # steps/church_search_steps.py:296

  @church_search @headers @validation @pay_to_church @sasai
  Scenario: Verify church search response headers                                        # features/pay_to_church/14_churchSearch.feature:220
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response header "Content-Type" should be present                                 # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"                 # steps/common_steps.py:229

  @church_search @security @pay_to_church @sasai
  Scenario: Verify church search with missing Authorization header                       # features/pay_to_church/14_churchSearch.feature:232
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have no Authorization header                                                 # steps/login_devices_steps.py:139
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 401                                              # steps/common_steps.py:116

  @church_search @security @pay_to_church @sasai
  Scenario: Verify church search with empty Bearer token                                 # features/pay_to_church/14_churchSearch.feature:242
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                                      # steps/login_devices_steps.py:146
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 401                                              # steps/common_steps.py:116

  @church_search @security @pay_to_church @sasai
  Scenario: Verify church search with malformed Bearer token                             # features/pay_to_church/14_churchSearch.feature:252
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                                  # steps/login_devices_steps.py:131
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 401                                              # steps/common_steps.py:116

  @church_search @error_handling @pay_to_church @sasai
  Scenario: Church search with invalid HTTP method POST                         # features/pay_to_church/14_churchSearch.feature:262
    Given API is available                                                      # steps/common_steps.py:9
    And I am authenticated with valid app token                                 # steps/otp_steps.py:9
    And I have valid user token from PIN verification                           # steps/login_devices_steps.py:9
    Given I have valid user authentication                                      # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                             # steps/school_search_steps.py:21
    When I send POST request to "/bff/v1/catalog/search-school-church-merchant" # steps/common_steps.py:28
    Then response status code should be 405                                     # steps/common_steps.py:116

  @church_search @error_handling @pay_to_church @sasai
  Scenario: Church search with wrong endpoint path             # features/pay_to_church/14_churchSearch.feature:269
    Given API is available                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                # steps/otp_steps.py:9
    And I have valid user token from PIN verification          # steps/login_devices_steps.py:9
    Given I have valid user authentication                     # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                            # steps/school_search_steps.py:21
    When I send GET request to "/bff/v1/catalog/search-church" # steps/common_steps.py:50
    Then response status code should be 404                    # steps/common_steps.py:116

  @church_search @performance @pay_to_church @sasai
  Scenario: Verify church search response time                                           # features/pay_to_church/14_churchSearch.feature:276
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response time should be less than 3000 ms                                        # steps/common_steps.py:169

  @church_search @performance @pay_to_church @sasai
  Scenario: Verify church search response time is acceptable                             # features/pay_to_church/14_churchSearch.feature:287
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response time should be less than 5000 ms                                        # steps/common_steps.py:169

  @church_search @integration @pay_to_church @sasai
  Scenario: Complete flow - PIN Verify to Church Search                                                    # features/pay_to_church/14_churchSearch.feature:298
    Given API is available                                                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                                                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                      # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                                            # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                                      # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                                # steps/common_steps.py:116
    And I store the user token from response                                                               # steps/login_devices_steps.py:260
    Given I have search type "CHURCH"                                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                                               # steps/school_search_steps.py:28
    And I have page size 10                                                                                # steps/school_search_steps.py:35
    And I have name query "church"                                                                         # steps/school_search_steps.py:42
    When I send church search request with stored token to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:98
    Then response status code should be 200                                                                # steps/common_steps.py:116
    And response should contain search results                                                             # steps/school_search_steps.py:152

  @church_search @data_validation @pay_to_church @sasai
  Scenario: Verify church search results are churches only                               # features/pay_to_church/14_churchSearch.feature:312
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And all results should be of type church                                             # steps/church_search_steps.py:220

  @church_search @data_validation @pay_to_church @sasai
  Scenario: Verify church search returns correct page size                               # features/pay_to_church/14_churchSearch.feature:323
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 5                                                               # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain at most 5 results                                        # steps/church_search_steps.py:344

  @church_search @data_validation @pay_to_church @sasai
  Scenario: Verify church names contain search query                                     # features/pay_to_church/14_churchSearch.feature:334
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "baptist"                                                      # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And church names should contain "baptist"                                            # steps/church_search_steps.py:245

  @church_search @special_chars @pay_to_church @sasai
  Scenario: Search churches with special characters in query                             # features/pay_to_church/14_churchSearch.feature:345
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "st. mary's"                                                   # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116

  @church_search @case_sensitivity @pay_to_church @sasai
  Scenario: Search churches is case insensitive                                          # features/pay_to_church/14_churchSearch.feature:355
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "CHURCH"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152

  @church_search @partial_match @pay_to_church @sasai
  Scenario: Search churches with partial name match                                      # features/pay_to_church/14_churchSearch.feature:366
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "chr"                                                          # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152

  @church_search @no_results @pay_to_church @sasai
  Scenario: Search churches with no matching results                                     # features/pay_to_church/14_churchSearch.feature:377
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "xyzabc123nonexistent"                                         # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should have empty results                                               # steps/church_search_steps.py:203

  @church_search @pagination @pay_to_church @sasai
  Scenario Outline: Search churches with different page numbers -- @1.1                  # features/pay_to_church/14_churchSearch.feature:399
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116

  @church_search @pagination @pay_to_church @sasai
  Scenario Outline: Search churches with different page numbers -- @1.2                  # features/pay_to_church/14_churchSearch.feature:400
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 1                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116

  @church_search @pagination @pay_to_church @sasai
  Scenario Outline: Search churches with different page numbers -- @1.3                  # features/pay_to_church/14_churchSearch.feature:401
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 2                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116

  @church_search @page_sizes @pay_to_church @sasai
  Scenario Outline: Search churches with different page sizes -- @1.1                    # features/pay_to_church/14_churchSearch.feature:416
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 5                                                               # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain at most 5 results                                        # steps/church_search_steps.py:344

  @church_search @page_sizes @pay_to_church @sasai
  Scenario Outline: Search churches with different page sizes -- @1.2                    # features/pay_to_church/14_churchSearch.feature:417
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain at most 10 results                                       # steps/church_search_steps.py:344

  @church_search @page_sizes @pay_to_church @sasai
  Scenario Outline: Search churches with different page sizes -- @1.3                    # features/pay_to_church/14_churchSearch.feature:418
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 15                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain at most 15 results                                       # steps/church_search_steps.py:344

  @church_search @page_sizes @pay_to_church @sasai
  Scenario Outline: Search churches with different page sizes -- @1.4                    # features/pay_to_church/14_churchSearch.feature:419
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 20                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain at most 20 results                                       # steps/church_search_steps.py:344

  @church_search @name_queries @pay_to_church @sasai
  Scenario Outline: Search churches with different name queries -- @1.1                  # features/pay_to_church/14_churchSearch.feature:433
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116

  @church_search @name_queries @pay_to_church @sasai
  Scenario Outline: Search churches with different name queries -- @1.2                  # features/pay_to_church/14_churchSearch.feature:434
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "baptist"                                                      # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116

  @church_search @name_queries @pay_to_church @sasai
  Scenario Outline: Search churches with different name queries -- @1.3                  # features/pay_to_church/14_churchSearch.feature:435
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "catholic"                                                     # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116

  @church_search @name_queries @pay_to_church @sasai
  Scenario Outline: Search churches with different name queries -- @1.4                  # features/pay_to_church/14_churchSearch.feature:436
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "methodist"                                                    # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116

  @church_search @name_queries @pay_to_church @sasai
  Scenario Outline: Search churches with different name queries -- @1.5                  # features/pay_to_church/14_churchSearch.feature:437
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "apostolic"                                                    # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116

  @church_search @extract_data @pay_to_church @sasai
  Scenario: Extract church code from search results                                      # features/pay_to_church/14_churchSearch.feature:440
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152
    And I extract first merchant code from search results                                # steps/merchant_lookup_code_steps.py:528
    And extracted code should not be empty                                               # steps/church_search_steps.py:367

  @church_search @sort_order @pay_to_church @sasai
  Scenario: Verify church search results are sorted                                      # features/pay_to_church/14_churchSearch.feature:453
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant" # steps/church_search_steps.py:46
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152
    And results should be in alphabetical order                                          # steps/church_search_steps.py:317

Feature: Church Lookup by Code # features/pay_to_church/15_churchLookupByCode.feature:1
  As a user
  I want to lookup church details by merchant code
  So that I can verify church information before making payments
  Background:   # features/pay_to_church/15_churchLookupByCode.feature:11

  @smoke @church_lookup @pay_to_church @sasai
  Scenario: Lookup church with valid merchant code                                   # features/pay_to_church/15_churchLookupByCode.feature:17
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172
    And merchant response should contain code                                        # steps/merchant_lookup_code_steps.py:238

  @church_lookup @positive @pay_to_church @sasai
  Scenario: Lookup church returns correct structure                                  # features/pay_to_church/15_churchLookupByCode.feature:26
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response body should be valid JSON                                           # steps/common_steps.py:139
    And response should have merchant structure                                      # steps/merchant_lookup_code_steps.py:198

  @church_lookup @positive @pay_to_church @sasai
  Scenario: Lookup church returns complete details                                   # features/pay_to_church/15_churchLookupByCode.feature:35
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And merchant response should contain name                                        # steps/merchant_lookup_code_steps.py:226
    And response should have merchant type field                                     # steps/merchant_lookup_code_steps.py:335

  @church_lookup @positive @pay_to_church @sasai
  Scenario: Lookup church with different valid code                                  # features/pay_to_church/15_churchLookupByCode.feature:44
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "123456"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church without authentication                                     # features/pay_to_church/15_churchLookupByCode.feature:51
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have no authentication token                                             # steps/login_devices_steps.py:100
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church with invalid user token                                    # features/pay_to_church/15_churchLookupByCode.feature:58
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have invalid user token                                                  # steps/login_devices_steps.py:123
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church with expired user token                                    # features/pay_to_church/15_churchLookupByCode.feature:65
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have expired user token                                                  # steps/login_devices_steps.py:115
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church with app token instead of user token                       # features/pay_to_church/15_churchLookupByCode.feature:72
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have app token only                                                      # steps/login_devices_steps.py:108
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401 or 403                                   # steps/common_steps.py:123

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church without merchant code parameter                            # features/pay_to_church/15_churchLookupByCode.feature:79
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have no merchant code                                                      # steps/merchant_lookup_code_steps.py:28
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400                                          # steps/common_steps.py:116

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church with empty merchant code                                   # features/pay_to_church/15_churchLookupByCode.feature:86
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code ""/bff/v1/catalog/merchant-lookup                                                      # steps/merchant_lookup_code_steps.py:70
    When I send merchant lookup by code 400uest to "/bff/v1/catalog/merchant-lookup" # steps/common_steps.py:116
    Then response status code should be 400                                          # None

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church with non-existent code                                     # features/pay_to_church/15_churchLookupByCode.feature:93
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "999999999"                                             # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 404                                          # steps/common_steps.py:116

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church with invalid code format - letters                         # features/pay_to_church/15_churchLookupByCode.feature:100
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "ABCDEF"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church with invalid code format - special chars                   # features/pay_to_church/15_churchLookupByCode.feature:107
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "123@#$"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400                                          # steps/common_steps.py:116

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church with negative merchant code                                # features/pay_to_church/15_churchLookupByCode.feature:114
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "-123456"                                               # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @church_lookup @negative @pay_to_church @sasai
  Scenario: Lookup church with zero merchant code                                    # features/pay_to_church/15_churchLookupByCode.feature:121
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "0"                                                     # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 404                                          # steps/common_steps.py:116

  @church_lookup @validation @pay_to_church @sasai
  Scenario: Verify church lookup response contains required fields                   # features/pay_to_church/15_churchLookupByCode.feature:128
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And merchant response should contain code                                        # steps/merchant_lookup_code_steps.py:238
    And merchant response should contain name                                        # steps/merchant_lookup_code_steps.py:226

  @church_lookup @validation @pay_to_church @sasai
  Scenario: Verify church lookup response structure                                  # features/pay_to_church/15_churchLookupByCode.feature:137
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response body should be valid JSON                                           # steps/common_steps.py:139
    And response should have merchant structure                                      # steps/merchant_lookup_code_steps.py:198

  @church_lookup @validation @pay_to_church @sasai
  Scenario: Verify returned code matches requested code                              # features/pay_to_church/15_churchLookupByCode.feature:146
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response merchant code should match "394875"                                 # steps/merchant_lookup_code_steps.py:351

  @church_lookup @headers @validation @pay_to_church @sasai
  Scenario: Verify church lookup response headers                                    # features/pay_to_church/15_churchLookupByCode.feature:154
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response header "Content-Type" should be present                             # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"             # steps/common_steps.py:229

  @church_lookup @headers @validation @pay_to_church @sasai
  Scenario: Verify church lookup accepts JSON                                        # features/pay_to_church/15_churchLookupByCode.feature:163
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    And I set request header "Accept" to "application/json"                          # steps/merchant_lookup_code_steps.py:326
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116

  @church_lookup @security @pay_to_church @sasai
  Scenario: Verify church lookup with missing Authorization header                   # features/pay_to_church/15_churchLookupByCode.feature:171
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have no Authorization header                                             # steps/login_devices_steps.py:139
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @church_lookup @security @pay_to_church @sasai
  Scenario: Verify church lookup with empty Bearer token                             # features/pay_to_church/15_churchLookupByCode.feature:178
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                                  # steps/login_devices_steps.py:146
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @church_lookup @security @pay_to_church @sasai
  Scenario: Verify church lookup with malformed Bearer token                         # features/pay_to_church/15_churchLookupByCode.feature:185
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                              # steps/login_devices_steps.py:131
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @church_lookup @error_handling @pay_to_church @sasai
  Scenario: Church lookup with invalid HTTP method POST           # features/pay_to_church/15_churchLookupByCode.feature:192
    Given API is available                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification             # steps/login_devices_steps.py:9
    Given I have valid user authentication                        # steps/login_devices_steps.py:92
    And I have merchant code "394875"                             # steps/merchant_lookup_code_steps.py:21
    When I send POST request to "/bff/v1/catalog/merchant-lookup" # steps/common_steps.py:28
    Then response status code should be 405                       # steps/common_steps.py:116

  @church_lookup @error_handling @pay_to_church @sasai
  Scenario: Church lookup with invalid HTTP method PUT           # features/pay_to_church/15_churchLookupByCode.feature:199
    Given API is available                                       # steps/common_steps.py:9
    And I am authenticated with valid app token                  # steps/otp_steps.py:9
    And I have valid user token from PIN verification            # steps/login_devices_steps.py:9
    Given I have valid user authentication                       # steps/login_devices_steps.py:92
    And I have merchant code "394875"                            # steps/merchant_lookup_code_steps.py:21
    When I send PUT request to "/bff/v1/catalog/merchant-lookup" # steps/common_steps.py:70
    Then response status code should be 405                      # steps/common_steps.py:116

  @church_lookup @error_handling @pay_to_church @sasai
  Scenario: Church lookup with invalid HTTP method DELETE           # features/pay_to_church/15_churchLookupByCode.feature:206
    Given API is available                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification               # steps/login_devices_steps.py:9
    Given I have valid user authentication                          # steps/login_devices_steps.py:92
    And I have merchant code "394875"                               # steps/merchant_lookup_code_steps.py:21
    When I send DELETE request to "/bff/v1/catalog/merchant-lookup" # steps/common_steps.py:92
    Then response status code should be 405                         # steps/common_steps.py:116

  @church_lookup @error_handling @pay_to_church @sasai
  Scenario: Church lookup with wrong endpoint path                # features/pay_to_church/15_churchLookupByCode.feature:213
    Given API is available                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification             # steps/login_devices_steps.py:9
    Given I have valid user authentication                        # steps/login_devices_steps.py:92
    And I have merchant code "394875"                             # steps/merchant_lookup_code_steps.py:21
    When I send GET request to "/bff/v1/catalog/merchant-details" # steps/common_steps.py:50
    Then response status code should be 404                       # steps/common_steps.py:116

  @church_lookup @performance @pay_to_church @sasai
  Scenario: Verify church lookup response time                                       # features/pay_to_church/15_churchLookupByCode.feature:220
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response time should be less than 2000 ms                                    # steps/common_steps.py:169

  @church_lookup @performance @pay_to_church @sasai
  Scenario: Verify church lookup response time is acceptable                         # features/pay_to_church/15_churchLookupByCode.feature:228
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response time should be less than 3000 ms                                    # steps/common_steps.py:169

  @church_lookup @integration @pay_to_church @sasai
  Scenario: Complete flow - Search Church to Lookup Details                                              # features/pay_to_church/15_churchLookupByCode.feature:236
    Given API is available                                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant"                 # steps/church_search_steps.py:46
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And I extract first merchant code from search results                                                # steps/merchant_lookup_code_steps.py:528
    When I send merchant lookup by code request with extracted code to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:135
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And response should contain merchant details by code                                                 # steps/merchant_lookup_code_steps.py:172

  @church_lookup @integration @pay_to_church @sasai
  Scenario: Complete flow - PIN Verify to Church Lookup                                                # features/pay_to_church/15_churchLookupByCode.feature:250
    Given API is available                                                                             # steps/common_steps.py:9
    And I am authenticated with valid app token                                                        # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                  # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                                        # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                                  # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                            # steps/common_steps.py:116
    And I store the user token from response                                                           # steps/login_devices_steps.py:260
    Given I have merchant code "394875"                                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request with stored token to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:127
    Then response status code should be 200                                                            # steps/common_steps.py:116
    And response should contain merchant details by code                                               # steps/merchant_lookup_code_steps.py:172

  @church_lookup @data_validation @pay_to_church @sasai
  Scenario: Verify church type in lookup response                                    # features/pay_to_church/15_churchLookupByCode.feature:261
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And merchant type should be "CHURCH"                                             # steps/merchant_lookup_code_steps.py:373

  @church_lookup @data_validation @pay_to_church @sasai
  Scenario: Verify church name is not empty                                          # features/pay_to_church/15_churchLookupByCode.feature:269
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And merchant name should not be empty                                            # steps/merchant_lookup_code_steps.py:276

  @church_lookup @data_validation @pay_to_church @sasai
  Scenario: Verify church code format in response                                    # features/pay_to_church/15_churchLookupByCode.feature:277
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And merchant code should be numeric string                                       # steps/merchant_lookup_code_steps.py:395

  @church_lookup @cache @pay_to_church @sasai
  Scenario: Verify church lookup caching behavior                                    # features/pay_to_church/15_churchLookupByCode.feature:285
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And I store response time as first_request_time                                  # steps/merchant_lookup_code_steps.py:417
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should match previous response                                      # steps/merchant_lookup_code_steps.py:424

  @church_lookup @special_codes @pay_to_church @sasai
  Scenario Outline: Lookup church with different merchant codes -- @1.1              # features/pay_to_church/15_churchLookupByCode.feature:304
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116

  @church_lookup @special_codes @pay_to_church @sasai
  Scenario Outline: Lookup church with different merchant codes -- @1.2              # features/pay_to_church/15_churchLookupByCode.feature:305
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "123456"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @special_codes @pay_to_church @sasai
  Scenario Outline: Lookup church with different merchant codes -- @1.3              # features/pay_to_church/15_churchLookupByCode.feature:306
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "111111"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @special_codes @pay_to_church @sasai
  Scenario Outline: Lookup church with different merchant codes -- @1.4              # features/pay_to_church/15_churchLookupByCode.feature:307
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "999999"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @concurrent @pay_to_church @sasai
  Scenario: Multiple church lookups with same token                                  # features/pay_to_church/15_churchLookupByCode.feature:310
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116

  @church_lookup @code_length @pay_to_church @sasai
  Scenario Outline: Lookup church with different code lengths -- @1.1                # features/pay_to_church/15_churchLookupByCode.feature:329
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "1"                                                     # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @code_length @pay_to_church @sasai
  Scenario Outline: Lookup church with different code lengths -- @1.2                # features/pay_to_church/15_churchLookupByCode.feature:330
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "12"                                                    # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @code_length @pay_to_church @sasai
  Scenario Outline: Lookup church with different code lengths -- @1.3                # features/pay_to_church/15_churchLookupByCode.feature:331
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "123"                                                   # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @code_length @pay_to_church @sasai
  Scenario Outline: Lookup church with different code lengths -- @1.4                # features/pay_to_church/15_churchLookupByCode.feature:332
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "1234"                                                  # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @code_length @pay_to_church @sasai
  Scenario Outline: Lookup church with different code lengths -- @1.5                # features/pay_to_church/15_churchLookupByCode.feature:333
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "12345"                                                 # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @code_length @pay_to_church @sasai
  Scenario Outline: Lookup church with different code lengths -- @1.6                # features/pay_to_church/15_churchLookupByCode.feature:334
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "123456"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @code_length @pay_to_church @sasai
  Scenario Outline: Lookup church with different code lengths -- @1.7                # features/pay_to_church/15_churchLookupByCode.feature:335
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "1234567"                                               # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @code_length @pay_to_church @sasai
  Scenario Outline: Lookup church with different code lengths -- @1.8                # features/pay_to_church/15_churchLookupByCode.feature:336
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "12345678"                                              # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @sql_injection @security @pay_to_church @sasai
  Scenario: Church lookup with SQL injection attempt                                 # features/pay_to_church/15_churchLookupByCode.feature:339
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875' OR '1'='1"                                     # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123
    And response should not contain database error                                   # steps/merchant_lookup_code_steps.py:436

  @church_lookup @xss @security @pay_to_church @sasai
  Scenario: Church lookup with XSS attempt                                           # features/pay_to_church/15_churchLookupByCode.feature:347
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "<script>alert('xss')</script>"                         # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @church_lookup @extract_data @pay_to_church @sasai
  Scenario: Extract church details for payment                                       # features/pay_to_church/15_churchLookupByCode.feature:354
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And I extract merchant name from response                                        # steps/merchant_lookup_code_steps.py:450
    And I extract merchant code from response                                        # steps/merchant_lookup_code_steps.py:469
    And extracted details should not be empty                                        # steps/merchant_lookup_code_steps.py:488

  @church_lookup @boundary @pay_to_church @sasai
  Scenario: Lookup church with maximum length code                                   # features/pay_to_church/15_churchLookupByCode.feature:364
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "99999999999999999999"                                  # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @church_lookup @whitespace @pay_to_church @sasai
  Scenario: Lookup church with code containing whitespace                            # features/pay_to_church/15_churchLookupByCode.feature:371
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394 875"                                               # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400                                          # steps/common_steps.py:116

  @church_lookup @leading_zeros @pay_to_church @sasai
  Scenario: Lookup church with leading zeros in code                                 # features/pay_to_church/15_churchLookupByCode.feature:378
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "0000394875"                                            # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200 or 404                                   # steps/common_steps.py:123

  @church_lookup @unicode @pay_to_church @sasai
  Scenario: Lookup church with unicode characters                                    # features/pay_to_church/15_churchLookupByCode.feature:385
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code ""                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400                                          # steps/common_steps.py:116

  @church_lookup @stress @pay_to_church @sasai
  Scenario: Rapid church lookup requests                                                # features/pay_to_church/15_churchLookupByCode.feature:392
    Given API is available                                                              # steps/common_steps.py:9
    And I am authenticated with valid app token                                         # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                   # steps/login_devices_steps.py:9
    Given I have valid user authentication                                              # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                   # steps/merchant_lookup_code_steps.py:21
    When I send 5 merchant lookup by code requests to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:142
    Then all requests should return status code 200                                     # steps/merchant_lookup_code_steps.py:500
    And all responses should be consistent                                              # steps/merchant_lookup_code_steps.py:513

Feature: Church Payment Options # features/pay_to_church/16_churchPaymentOptions.feature:1
  As a user
  I want to get available payment options for church payments
  So that I can choose how to make my church donation
  Background:   # features/pay_to_church/16_churchPaymentOptions.feature:12

  @smoke @church_payment_options @pay_to_church @sasai
  Scenario: Get church payment options with valid authentication            # features/pay_to_church/16_churchPaymentOptions.feature:18
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should have payment options                                # steps/school_payment_options_steps.py:213
    And response should have payment instruments                            # None

  @church_payment_options @positive @pay_to_church @sasai
  Scenario: Get church payment options returns correct structure            # features/pay_to_church/16_churchPaymentOptions.feature:28
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response body should be valid JSON                                  # steps/common_steps.py:139
    And response should have payment options structure                      # steps/payment_options_steps.py:249

  @church_payment_options @positive @pay_to_church @sasai
  Scenario: Get church payment options with all required headers            # features/pay_to_church/16_churchPaymentOptions.feature:38
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have all required device headers                                  # steps/school_payment_options_steps.py:44
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain wallet payment option                       # steps/school_payment_options_steps.py:235

  @church_payment_options @positive @pay_to_church @sasai
  Scenario: Get church payment options with location headers                # features/pay_to_church/16_churchPaymentOptions.feature:47
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    And I have latitude "28.508632"                                         # steps/school_payment_options_steps.py:98
    And I have longitude "77.092242"                                        # steps/school_payment_options_steps.py:107
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116

  @church_payment_options @negative @pay_to_church @sasai
  Scenario: Get church payment options without authentication               # features/pay_to_church/16_churchPaymentOptions.feature:57
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have no authentication token                                    # steps/login_devices_steps.py:100
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 401                                 # steps/common_steps.py:116

  @church_payment_options @negative @pay_to_church @sasai
  Scenario: Get church payment options with invalid user token              # features/pay_to_church/16_churchPaymentOptions.feature:65
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have invalid user token                                         # steps/login_devices_steps.py:123
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 401                                 # steps/common_steps.py:116

  @church_payment_options @negative @pay_to_church @sasai
  Scenario: Get church payment options with expired user token              # features/pay_to_church/16_churchPaymentOptions.feature:73
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have expired user token                                         # steps/login_devices_steps.py:115
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 401                                 # steps/common_steps.py:116

  @church_payment_options @negative @pay_to_church @sasai
  Scenario: Get church payment options with app token instead of user token  # features/pay_to_church/16_churchPaymentOptions.feature:81
    Given API is available                                                   # steps/common_steps.py:9
    And I am authenticated with valid app token                              # steps/otp_steps.py:9
    And I have valid user token from PIN verification                        # steps/login_devices_steps.py:9
    Given I have app token only                                              # steps/login_devices_steps.py:108
    And I have service type "sasai-app-payment"                              # steps/payment_options_steps.py:16
    And I have device information headers                                    # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options"  # steps/church_payment_options_steps.py:20
    Then response status code should be 401 or 403                           # steps/common_steps.py:123

  @church_payment_options @negative @pay_to_church @sasai
  Scenario: Get church payment options without service type parameter       # features/pay_to_church/16_churchPaymentOptions.feature:89
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have no service type                                              # steps/school_payment_options_steps.py:27
    And I have device information headers/bff/v2/payment/options                                   # steps/church_payment_options_steps.py:20
    When I send church payment options r400est to "/bff/v2/payment/options" # steps/common_steps.py:116
    Then response status code should be 400                                 # None

  @church_payment_options @negative @pay_to_church @sasai
  Scenario: Get church payment options with empty service type              # features/pay_to_church/16_churchPaymentOptions.feature:97
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type ""                                              # steps/school_payment_options_steps.py:27
    And I have device information headers/bff/v2/payment/options                                   # steps/church_payment_options_steps.py:20
    When I send church payment options r400est to "/bff/v2/payment/options" # steps/common_steps.py:116
    Then response status code should be 400                                 # None

  @church_payment_options @negative @pay_to_church @sasai
  Scenario: Get church payment options with invalid service type            # features/pay_to_church/16_churchPaymentOptions.feature:105
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "invalid-service-type"                          # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 400 or 404                          # steps/common_steps.py:123

  @church_payment_options @validation @pay_to_church @sasai
  Scenario: Verify church payment options response contains required fields  # features/pay_to_church/16_churchPaymentOptions.feature:113
    Given API is available                                                   # steps/common_steps.py:9
    And I am authenticated with valid app token                              # steps/otp_steps.py:9
    And I have valid user token from PIN verification                        # steps/login_devices_steps.py:9
    Given I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                              # steps/payment_options_steps.py:16
    And I have device information headers                                    # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options"  # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                  # steps/common_steps.py:116
    And response should have payment options                                 # steps/school_payment_options_steps.py:213
    And response should have payment instruments                             # None

  @church_payment_options @validation @pay_to_church @sasai
  Scenario: Verify church payment options response structure                # features/pay_to_church/16_churchPaymentOptions.feature:123
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response body should be valid JSON                                  # steps/common_steps.py:139
    And response should have payment options structure                      # steps/payment_options_steps.py:249

  @church_payment_options @headers @validation @pay_to_church @sasai
  Scenario: Verify church payment options response headers                  # features/pay_to_church/16_churchPaymentOptions.feature:133
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response header "Content-Type" should be present                    # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"    # steps/common_steps.py:229

  @church_payment_options @headers @validation @pay_to_church @sasai
  Scenario: Church payment options with request ID header                   # features/pay_to_church/16_churchPaymentOptions.feature:143
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have request ID "43843e90-d1c8-11f0-a41e-95f35da604e5"            # steps/merchant_lookup_steps.py:94
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116

  @church_payment_options @device_headers @pay_to_church @sasai
  Scenario: Church payment options with device type header                  # features/pay_to_church/16_churchPaymentOptions.feature:152
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device type "android"                                        # steps/school_payment_options_steps.py:71
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116

  @church_payment_options @device_headers @pay_to_church @sasai
  Scenario: Church payment options with OS version header                   # features/pay_to_church/16_churchPaymentOptions.feature:161
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have OS version "15"                                              # steps/school_payment_options_steps.py:80
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116

  @church_payment_options @device_headers @pay_to_church @sasai
  Scenario: Church payment options with app version header                  # features/pay_to_church/16_churchPaymentOptions.feature:170
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have app version "2.2.1"                                          # steps/school_payment_options_steps.py:89
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116

  @church_payment_options @security @pay_to_church @sasai
  Scenario: Verify church payment options with missing Authorization header  # features/pay_to_church/16_churchPaymentOptions.feature:179
    Given API is available                                                   # steps/common_steps.py:9
    And I am authenticated with valid app token                              # steps/otp_steps.py:9
    And I have valid user token from PIN verification                        # steps/login_devices_steps.py:9
    Given I have no Authorization header                                     # steps/login_devices_steps.py:139
    And I have service type "sasai-app-payment"                              # steps/payment_options_steps.py:16
    And I have device information headers                                    # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options"  # steps/church_payment_options_steps.py:20
    Then response status code should be 401                                  # steps/common_steps.py:116

  @church_payment_options @security @pay_to_church @sasai
  Scenario: Verify church payment options with empty Bearer token           # features/pay_to_church/16_churchPaymentOptions.feature:187
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                         # steps/login_devices_steps.py:146
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 401                                 # steps/common_steps.py:116

  @church_payment_options @security @pay_to_church @sasai
  Scenario: Verify church payment options with malformed Bearer token       # features/pay_to_church/16_churchPaymentOptions.feature:195
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                     # steps/login_devices_steps.py:131
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 401                                 # steps/common_steps.py:116

  @church_payment_options @error_handling @pay_to_church @sasai
  Scenario: Church payment options with invalid HTTP method POST  # features/pay_to_church/16_churchPaymentOptions.feature:203
    Given API is available                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification             # steps/login_devices_steps.py:9
    Given I have valid user authentication                        # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                   # steps/payment_options_steps.py:16
    When I send POST request to "/bff/v2/payment/options"         # steps/common_steps.py:28
    Then response status code should be 405                       # steps/common_steps.py:116

  @church_payment_options @error_handling @pay_to_church @sasai
  Scenario: Church payment options with invalid HTTP method PUT  # features/pay_to_church/16_churchPaymentOptions.feature:210
    Given API is available                                       # steps/common_steps.py:9
    And I am authenticated with valid app token                  # steps/otp_steps.py:9
    And I have valid user token from PIN verification            # steps/login_devices_steps.py:9
    Given I have valid user authentication                       # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                  # steps/payment_options_steps.py:16
    When I send PUT request to "/bff/v2/payment/options"         # steps/common_steps.py:70
    Then response status code should be 405                      # steps/common_steps.py:116

  @church_payment_options @error_handling @pay_to_church @sasai
  Scenario: Church payment options with invalid HTTP method DELETE  # features/pay_to_church/16_churchPaymentOptions.feature:217
    Given API is available                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification               # steps/login_devices_steps.py:9
    Given I have valid user authentication                          # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                     # steps/payment_options_steps.py:16
    When I send DELETE request to "/bff/v2/payment/options"         # steps/common_steps.py:92
    Then response status code should be 405                         # steps/common_steps.py:116

  @church_payment_options @error_handling @pay_to_church @sasai
  Scenario: Church payment options with wrong endpoint path  # features/pay_to_church/16_churchPaymentOptions.feature:224
    Given API is available                                   # steps/common_steps.py:9
    And I am authenticated with valid app token              # steps/otp_steps.py:9
    And I have valid user token from PIN verification        # steps/login_devices_steps.py:9
    Given I have valid user authentication                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"              # steps/payment_options_steps.py:16
    When I send GET request to "/bff/v2/payment/option"      # steps/common_steps.py:50
    Then response status code should be 404                  # steps/common_steps.py:116

  @church_payment_options @performance @pay_to_church @sasai
  Scenario: Verify church payment options response time                     # features/pay_to_church/16_churchPaymentOptions.feature:231
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response time should be less than 3000 ms                           # steps/common_steps.py:169

  @church_payment_options @performance @pay_to_church @sasai
  Scenario: Verify church payment options response time is acceptable       # features/pay_to_church/16_churchPaymentOptions.feature:240
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response time should be less than 5000 ms                           # steps/common_steps.py:169

  @church_payment_options @integration @pay_to_church @sasai
  Scenario: Complete flow - Church Lookup to Payment Options                         # features/pay_to_church/16_churchPaymentOptions.feature:249
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "394875"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172
    Given I have service type "sasai-app-payment"                                    # steps/payment_options_steps.py:16
    And I have device information headers                                            # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options"          # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should have payment options                                         # None

  @church_payment_options @integration @pay_to_church @sasai
  Scenario: Complete flow - PIN Verify to Church Payment Options                              # features/pay_to_church/16_churchPaymentOptions.feature:262
    Given API is available                                                                    # steps/common_steps.py:9
    And I am authenticated with valid app token                                               # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                         # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                               # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                         # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                   # steps/common_steps.py:116
    And I store the user token from response                                                  # steps/login_devices_steps.py:260
    Given I have service type "sasai-app-payment"                                             # steps/payment_options_steps.py:16
    And I have device information headers                                                     # steps/school_payment_options_steps.py:27
    When I send church payment options request with stored token to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:31
    Then response status code should be 200                                                   # steps/common_steps.py:116
    And response should have payment options                                                  # None

  @church_payment_options @integration @pay_to_church @sasai
  Scenario: Complete flow - Church Search to Lookup to Payment Options                                   # features/pay_to_church/16_churchPaymentOptions.feature:274
    Given API is available                                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                                       # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant"                 # steps/church_search_steps.py:46
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And I extract first merchant code from search results                                                # steps/merchant_lookup_code_steps.py:528
    When I send merchant lookup by code request with extracted code to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:135
    Then response status code should be 200                                                              # steps/common_steps.py:116
    Given I have service type "sasai-app-payment"                                                        # steps/payment_options_steps.py:16
    And I have device information headers                                                                # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options"                              # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And response should have payment options                                                             # None

  @church_payment_options @data_validation @pay_to_church @sasai
  Scenario: Verify payment options contains wallet option                   # features/pay_to_church/16_churchPaymentOptions.feature:292
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain wallet payment option                       # steps/school_payment_options_steps.py:235

  @church_payment_options @data_validation @pay_to_church @sasai
  Scenario: Verify payment instruments are not empty                        # features/pay_to_church/16_churchPaymentOptions.feature:301
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And payment instruments should not be empty                             # steps/church_payment_options_steps.py:69

  @church_payment_options @cache @pay_to_church @sasai
  Scenario: Verify church payment options caching behavior                  # features/pay_to_church/16_churchPaymentOptions.feature:310
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And I store response time as first_request_time                         # steps/merchant_lookup_code_steps.py:417
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should match previous response                             # steps/merchant_lookup_code_steps.py:424

  @church_payment_options @concurrent @pay_to_church @sasai
  Scenario: Multiple church payment options requests with same token        # features/pay_to_church/16_churchPaymentOptions.feature:322
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116

  @church_payment_options @service_types @pay_to_church @sasai
  Scenario Outline: Church payment options with different service types -- @1.1   # features/pay_to_church/16_churchPaymentOptions.feature:343
    Given API is available                                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification                             # steps/login_devices_steps.py:9
    Given I have valid user authentication                                        # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                                   # steps/payment_options_steps.py:16
    And I have device information headers                                         # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options"       # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                       # steps/common_steps.py:116

  @church_payment_options @service_types @pay_to_church @sasai
  Scenario Outline: Church payment options with different service types -- @1.2   # features/pay_to_church/16_churchPaymentOptions.feature:344
    Given API is available                                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification                             # steps/login_devices_steps.py:9
    Given I have valid user authentication                                        # steps/login_devices_steps.py:92
    And I have service type "invalid-service"                                     # steps/payment_options_steps.py:16
    And I have device information headers                                         # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options"       # steps/church_payment_options_steps.py:20
    Then response status code should be 400 or 404                                # steps/common_steps.py:123

  @church_payment_options @service_types @pay_to_church @sasai
  Scenario Outline: Church payment options with different service types -- @1.3   # features/pay_to_church/16_churchPaymentOptions.feature:345
    Given API is available                                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification                             # steps/login_devices_steps.py:9
    Given I have valid user authentication                                        # steps/login_devices_steps.py:92
    And I have service type """"                                                  # steps/payment_options_steps.py:16
    And I have device information headers                                         # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options"       # steps/church_payment_options_steps.py:20
    Then response status code should be 400                                       # steps/common_steps.py:116

  @church_payment_options @location @pay_to_church @sasai
  Scenario Outline: Church payment options with different locations -- @1.1   # features/pay_to_church/16_churchPaymentOptions.feature:359
    Given API is available                                                    # steps/common_steps.py:9
    And I am authenticated with valid app token                               # steps/otp_steps.py:9
    And I have valid user token from PIN verification                         # steps/login_devices_steps.py:9
    Given I have valid user authentication                                    # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                               # steps/payment_options_steps.py:16
    And I have device information headers                                     # steps/school_payment_options_steps.py:27
    And I have latitude "28.508632"                                           # steps/school_payment_options_steps.py:98
    And I have longitude "77.092242"                                          # steps/school_payment_options_steps.py:107
    When I send church payment options request to "/bff/v2/payment/options"   # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                   # steps/common_steps.py:116

  @church_payment_options @location @pay_to_church @sasai
  Scenario Outline: Church payment options with different locations -- @1.2   # features/pay_to_church/16_churchPaymentOptions.feature:360
    Given API is available                                                    # steps/common_steps.py:9
    And I am authenticated with valid app token                               # steps/otp_steps.py:9
    And I have valid user token from PIN verification                         # steps/login_devices_steps.py:9
    Given I have valid user authentication                                    # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                               # steps/payment_options_steps.py:16
    And I have device information headers                                     # steps/school_payment_options_steps.py:27
    And I have latitude "-17.829773"                                          # steps/school_payment_options_steps.py:98
    And I have longitude "31.054028"                                          # steps/school_payment_options_steps.py:107
    When I send church payment options request to "/bff/v2/payment/options"   # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                   # steps/common_steps.py:116

  @church_payment_options @location @pay_to_church @sasai
  Scenario Outline: Church payment options with different locations -- @1.3   # features/pay_to_church/16_churchPaymentOptions.feature:361
    Given API is available                                                    # steps/common_steps.py:9
    And I am authenticated with valid app token                               # steps/otp_steps.py:9
    And I have valid user token from PIN verification                         # steps/login_devices_steps.py:9
    Given I have valid user authentication                                    # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                               # steps/payment_options_steps.py:16
    And I have device information headers                                     # steps/school_payment_options_steps.py:27
    And I have latitude "0.0"                                                 # steps/school_payment_options_steps.py:98
    And I have longitude "0.0"                                                # steps/school_payment_options_steps.py:107
    When I send church payment options request to "/bff/v2/payment/options"   # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                   # steps/common_steps.py:116

  @church_payment_options @extract_data @pay_to_church @sasai
  Scenario: Extract payment options for church donation                     # features/pay_to_church/16_churchPaymentOptions.feature:364
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And I extract available payment methods from response                   # steps/church_payment_options_steps.py:110
    And extracted payment methods should not be empty                       # steps/church_payment_options_steps.py:130

  @church_payment_options @wallet_validation @pay_to_church @sasai
  Scenario: Verify wallet balance in payment options                        # features/pay_to_church/16_churchPaymentOptions.feature:374
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain wallet payment option                       # steps/school_payment_options_steps.py:235
    And wallet option should have balance information                       # steps/church_payment_options_steps.py:85

  @church_payment_options @stress @pay_to_church @sasai
  Scenario: Rapid church payment options requests                              # features/pay_to_church/16_churchPaymentOptions.feature:384
    Given API is available                                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                                # steps/otp_steps.py:9
    And I have valid user token from PIN verification                          # steps/login_devices_steps.py:9
    Given I have valid user authentication                                     # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                                # steps/payment_options_steps.py:16
    And I have device information headers                                      # steps/school_payment_options_steps.py:27
    When I send 5 church payment options requests to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:38
    Then all requests should return status code 200                            # steps/merchant_lookup_code_steps.py:500
    And all responses should be consistent                                     # steps/merchant_lookup_code_steps.py:513

  @church_payment_options @headers_missing @pay_to_church @sasai
  Scenario: Church payment options without device headers                   # features/pay_to_church/16_churchPaymentOptions.feature:393
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200 or 400                          # steps/common_steps.py:123

  @church_payment_options @headers_optional @pay_to_church @sasai
  Scenario: Church payment options with minimal headers                     # features/pay_to_church/16_churchPaymentOptions.feature:400
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device type "android"                                        # steps/school_payment_options_steps.py:71
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116

Feature: Church Payment # features/pay_to_church/17_churchPayment.feature:1
  As a user
  I want to make payments to churches
  So that I can donate or contribute to church activities
  Background:   # features/pay_to_church/17_churchPayment.feature:12

  @smoke @church_payment @pay_to_church @sasai
  Scenario: Make church payment with valid details                        # features/pay_to_church/17_churchPayment.feature:18
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351
    And response should have transaction ID                               # steps/church_payment_steps.py:366

  @church_payment @positive @pay_to_church @sasai
  Scenario: Make church offering payment                                  # features/pay_to_church/17_churchPayment.feature:28
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with purpose "Offering"             # steps/church_payment_steps.py:66
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @church_payment @positive @pay_to_church @sasai
  Scenario: Make church tithe payment                                     # features/pay_to_church/17_churchPayment.feature:37
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with purpose "Tithe"                # steps/church_payment_steps.py:66
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @church_payment @positive @pay_to_church @sasai
  Scenario: Make church building fund payment                             # features/pay_to_church/17_churchPayment.feature:46
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with purpose "Building Fund"        # steps/church_payment_steps.py:66
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @church_payment @positive @pay_to_church @sasai
  Scenario: Church payment with minimum amount                            # features/pay_to_church/17_churchPayment.feature:55
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 1.0                     # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @positive @pay_to_church @sasai
  Scenario: Church payment with different amounts                         # features/pay_to_church/17_churchPayment.feature:63
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 10.0                    # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @positive @pay_to_church @sasai
  Scenario: Church payment with USD currency                              # features/pay_to_church/17_churchPayment.feature:71
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with currency "USD"                 # steps/church_payment_steps.py:93
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @positive @pay_to_church @sasai
  Scenario: Church payment with ZWL currency                              # features/pay_to_church/17_churchPayment.feature:79
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with currency "ZWL"                 # steps/church_payment_steps.py:93
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment without authentication                         # features/pay_to_church/17_churchPayment.feature:87
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have no authentication token                                  # steps/login_devices_steps.py:100
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 401                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with invalid user token                        # features/pay_to_church/17_churchPayment.feature:95
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have invalid user token                                       # steps/login_devices_steps.py:123
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 401                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with expired user token                        # features/pay_to_church/17_churchPayment.feature:103
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have expired user token                                       # steps/login_devices_steps.py:115
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 401                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with app token instead of user token           # features/pay_to_church/17_churchPayment.feature:111
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have app token only                                           # steps/login_devices_steps.py:108
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 401 or 403                        # steps/common_steps.py:123

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment without payment details                        # features/pay_to_church/17_churchPayment.feature:119
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have no payment details                                         # steps/church_payment_steps.py:102
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with missing instrument token                  # features/pay_to_church/17_churchPayment.feature:127
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details without instrument token            # steps/church_payment_steps.py:110
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with invalid instrument token                  # features/pay_to_church/17_churchPayment.feature:135
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with invalid instrument token       # steps/church_payment_steps.py:118
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with missing PIN                               # features/pay_to_church/17_churchPayment.feature:143
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details without PIN                         # steps/church_payment_steps.py:126
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with incorrect PIN                             # features/pay_to_church/17_churchPayment.feature:151
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with incorrect PIN                  # steps/church_payment_steps.py:134
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400 or 401                        # steps/common_steps.py:123

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with zero amount                               # features/pay_to_church/17_churchPayment.feature:159
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 0                       # steps/church_payment_steps.py:84
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with negative amount                           # features/pay_to_church/17_churchPayment.feature:167
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount -10.0                   # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with missing operator ID                       # features/pay_to_church/17_churchPayment.feature:175
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details without operator ID                 # steps/church_payment_steps.py:142
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with invalid operator ID                       # features/pay_to_church/17_churchPayment.feature:183
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with operator ID "INVALID123"       # steps/church_payment_steps.py:150
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400 or 404                        # steps/common_steps.py:123

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with missing category ID                       # features/pay_to_church/17_churchPayment.feature:191
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details without category ID                 # steps/church_payment_steps.py:158
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with invalid category ID                       # features/pay_to_church/17_churchPayment.feature:199
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with category ID "INVALID"          # steps/church_payment_steps.py:166
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400 or 404                        # steps/common_steps.py:123

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with missing church code                       # features/pay_to_church/17_churchPayment.feature:207
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details without church code                 # steps/church_payment_steps.py:174
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with invalid currency                          # features/pay_to_church/17_churchPayment.feature:215
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with currency "INVALID"             # steps/church_payment_steps.py:93
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with missing payment method                    # features/pay_to_church/17_churchPayment.feature:223
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details without payment method              # steps/church_payment_steps.py:183
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @negative @pay_to_church @sasai
  Scenario: Church payment with insufficient balance                      # features/pay_to_church/17_churchPayment.feature:231
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 999999.0                # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400 or 402                        # steps/common_steps.py:123

  @church_payment @validation @pay_to_church @sasai
  Scenario: Verify church payment response structure                      # features/pay_to_church/17_churchPayment.feature:239
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response body should be valid JSON                                # steps/common_steps.py:139
    And response should have payment structure                            # steps/church_payment_steps.py:398

  @church_payment @validation @pay_to_church @sasai
  Scenario: Verify church payment response contains required fields       # features/pay_to_church/17_churchPayment.feature:249
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And payment response should have required fields                      # steps/church_payment_steps.py:410

  @church_payment @validation @pay_to_church @sasai
  Scenario: Verify transaction ID format                                  # features/pay_to_church/17_churchPayment.feature:258
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should have transaction ID                               # steps/church_payment_steps.py:366
    And transaction ID should be valid format                             # steps/church_payment_steps.py:388

  @church_payment @headers @validation @pay_to_church @sasai
  Scenario: Verify church payment response headers                        # features/pay_to_church/17_churchPayment.feature:268
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response header "Content-Type" should be present                  # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"  # steps/common_steps.py:229

  @church_payment @headers @validation @pay_to_church @sasai
  Scenario: Church payment with request ID header                         # features/pay_to_church/17_churchPayment.feature:278
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have request ID "2e74fcf0-d426-11f0-9f80-97a3c8562f7e"          # steps/merchant_lookup_steps.py:94
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @security @pay_to_church @sasai
  Scenario: Verify church payment with missing Authorization header       # features/pay_to_church/17_churchPayment.feature:287
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have no Authorization header                                  # steps/login_devices_steps.py:139
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 401                               # steps/common_steps.py:116

  @church_payment @security @pay_to_church @sasai
  Scenario: Verify church payment with empty Bearer token                 # features/pay_to_church/17_churchPayment.feature:295
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                       # steps/login_devices_steps.py:146
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 401                               # steps/common_steps.py:116

  @church_payment @security @pay_to_church @sasai
  Scenario: Verify church payment with malformed Bearer token             # features/pay_to_church/17_churchPayment.feature:303
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                   # steps/login_devices_steps.py:131
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 401                               # steps/common_steps.py:116

  @church_payment @error_handling @pay_to_church @sasai
  Scenario: Church payment with invalid HTTP method GET        # features/pay_to_church/17_churchPayment.feature:311
    Given API is available                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                # steps/otp_steps.py:9
    And I have valid user token from PIN verification          # steps/login_devices_steps.py:9
    Given I have valid user authentication                     # steps/login_devices_steps.py:92
    And I have church payment details                          # steps/church_payment_steps.py:18
    When I send GET request to "/bff/v2/order/utility/payment" # steps/common_steps.py:50
    Then response status code should be 405                    # steps/common_steps.py:116

  @church_payment @error_handling @pay_to_church @sasai
  Scenario: Church payment with invalid HTTP method PUT        # features/pay_to_church/17_churchPayment.feature:318
    Given API is available                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                # steps/otp_steps.py:9
    And I have valid user token from PIN verification          # steps/login_devices_steps.py:9
    Given I have valid user authentication                     # steps/login_devices_steps.py:92
    And I have church payment details                          # steps/church_payment_steps.py:18
    When I send PUT request to "/bff/v2/order/utility/payment" # steps/common_steps.py:70
    Then response status code should be 405                    # steps/common_steps.py:116

  @church_payment @error_handling @pay_to_church @sasai
  Scenario: Church payment with invalid HTTP method DELETE        # features/pay_to_church/17_churchPayment.feature:325
    Given API is available                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification             # steps/login_devices_steps.py:9
    Given I have valid user authentication                        # steps/login_devices_steps.py:92
    And I have church payment details                             # steps/church_payment_steps.py:18
    When I send DELETE request to "/bff/v2/order/utility/payment" # steps/common_steps.py:92
    Then response status code should be 405                       # steps/common_steps.py:116

  @church_payment @error_handling @pay_to_church @sasai
  Scenario: Church payment with wrong endpoint path     # features/pay_to_church/17_churchPayment.feature:332
    Given API is available                              # steps/common_steps.py:9
    And I am authenticated with valid app token         # steps/otp_steps.py:9
    And I have valid user token from PIN verification   # steps/login_devices_steps.py:9
    Given I have valid user authentication              # steps/login_devices_steps.py:92
    And I have church payment details                   # steps/church_payment_steps.py:18
    And I have device information headers               # steps/school_payment_options_steps.py:27
    When I send POST request to "/bff/v2/order/payment" # steps/common_steps.py:28
    Then response status code should be 404             # steps/common_steps.py:116

  @church_payment @performance @pay_to_church @sasai
  Scenario: Verify church payment response time                           # features/pay_to_church/17_churchPayment.feature:340
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response time should be less than 5000 ms                         # steps/common_steps.py:169

  @church_payment @performance @pay_to_church @sasai
  Scenario: Verify church payment response time is acceptable             # features/pay_to_church/17_churchPayment.feature:349
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response time should be less than 10000 ms                        # steps/common_steps.py:169

  @church_payment @integration @pay_to_church @sasai
  Scenario: Complete flow - Payment Options to Church Payment               # features/pay_to_church/17_churchPayment.feature:358
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options" # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                 # steps/common_steps.py:116
    And I extract instrument token from response                            # steps/school_payment_options_steps.py:527
    Given I have church payment details with extracted instrument token     # steps/church_payment_steps.py:191
    When I send church payment request to "/bff/v2/order/utility/payment"   # steps/church_payment_steps.py:281
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain payment confirmation                        # steps/church_payment_steps.py:351

  @church_payment @integration @pay_to_church @sasai
  Scenario: Complete flow - Church Lookup to Payment                                 # features/pay_to_church/17_churchPayment.feature:371
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "156611"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And I extract merchant name from response                                        # steps/merchant_lookup_code_steps.py:450
    And I extract merchant code from response                                        # steps/merchant_lookup_code_steps.py:469
    Given I have church payment details with extracted merchant info                 # steps/church_payment_steps.py:199
    And I have device information headers                                            # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment"            # steps/church_payment_steps.py:281
    Then response status code should be 200                                          # steps/common_steps.py:116

  @church_payment @integration @pay_to_church @sasai
  Scenario: Complete flow - PIN Verify to Church Payment                                    # features/pay_to_church/17_churchPayment.feature:384
    Given API is available                                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                       # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                             # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                       # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                 # steps/common_steps.py:116
    And I store the user token from response                                                # steps/login_devices_steps.py:260
    Given I have church payment details                                                     # steps/church_payment_steps.py:18
    And I have device information headers                                                   # steps/school_payment_options_steps.py:27
    When I send church payment request with stored token to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:341
    Then response status code should be 200                                                 # steps/common_steps.py:116

  @church_payment @integration @pay_to_church @sasai
  Scenario: Complete end-to-end church payment flow                                                      # features/pay_to_church/17_churchPayment.feature:395
    Given API is available                                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                                              # steps/school_search_steps.py:35
    And I have name query "FAITH MINISTRIES"                                                             # steps/school_search_steps.py:42
    When I send church search request to "/bff/v1/catalog/search-school-church-merchant"                 # steps/church_search_steps.py:46
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And I extract first merchant code from search results                                                # steps/merchant_lookup_code_steps.py:528
    When I send merchant lookup by code request with extracted code to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:135
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And I extract merchant name from response                                                            # steps/merchant_lookup_code_steps.py:450
    Given I have service type "sasai-app-payment"                                                        # steps/payment_options_steps.py:16
    And I have device information headers                                                                # steps/school_payment_options_steps.py:27
    When I send church payment options request to "/bff/v2/payment/options"                              # steps/church_payment_options_steps.py:20
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And I extract instrument token from response                                                         # steps/school_payment_options_steps.py:527
    Given I have church payment details with extracted info                                              # steps/church_payment_steps.py:214
    When I send church payment request to "/bff/v2/order/utility/payment"                                # steps/church_payment_steps.py:281
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And response should contain payment confirmation                                                     # steps/church_payment_steps.py:351

  @church_payment @data_validation @pay_to_church @sasai
  Scenario: Verify payment confirmation details                           # features/pay_to_church/17_churchPayment.feature:422
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And payment confirmation should have transaction details              # steps/church_payment_steps.py:429
    And payment confirmation should have amount                           # steps/church_payment_steps.py:447

  @church_payment @data_validation @pay_to_church @sasai
  Scenario: Verify payment response contains church details               # features/pay_to_church/17_churchPayment.feature:432
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain church name                               # steps/church_payment_steps.py:465
    And response should contain church code                               # steps/church_payment_steps.py:482

  @church_payment @idempotency @pay_to_church @sasai
  Scenario: Duplicate payment with same request ID should be prevented    # features/pay_to_church/17_churchPayment.feature:442
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have request ID "duplicate-test-12345"                          # steps/merchant_lookup_steps.py:94
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400 or 409                        # steps/common_steps.py:123

  @church_payment @amount_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different amounts -- @1.1         # features/pay_to_church/17_churchPayment.feature:462
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 1.0                     # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @amount_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different amounts -- @1.2         # features/pay_to_church/17_churchPayment.feature:463
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 5.0                     # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @amount_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different amounts -- @1.3         # features/pay_to_church/17_churchPayment.feature:464
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 10.0                    # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @amount_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different amounts -- @1.4         # features/pay_to_church/17_churchPayment.feature:465
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 50.0                    # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @amount_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different amounts -- @1.5         # features/pay_to_church/17_churchPayment.feature:466
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 100.0                   # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @amount_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different amounts -- @1.6         # features/pay_to_church/17_churchPayment.feature:467
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 0.5                     # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200 or 400                        # steps/common_steps.py:123

  @church_payment @amount_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different amounts -- @1.7         # features/pay_to_church/17_churchPayment.feature:468
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with amount 0.01                    # steps/church_payment_steps.py:75
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200 or 400                        # steps/common_steps.py:123

  @church_payment @currency_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different currencies -- @1.1      # features/pay_to_church/17_churchPayment.feature:480
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with currency "USD"                 # steps/church_payment_steps.py:93
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @currency_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different currencies -- @1.2      # features/pay_to_church/17_churchPayment.feature:481
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with currency "ZWL"                 # steps/church_payment_steps.py:93
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @currency_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different currencies -- @1.3      # features/pay_to_church/17_churchPayment.feature:482
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with currency "EUR"                 # steps/church_payment_steps.py:93
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @currency_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different currencies -- @1.4      # features/pay_to_church/17_churchPayment.feature:483
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with currency "GBP"                 # steps/church_payment_steps.py:93
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 400                               # steps/common_steps.py:116

  @church_payment @purpose_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different purposes -- @1.1        # features/pay_to_church/17_churchPayment.feature:495
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with purpose "Offering"             # steps/church_payment_steps.py:66
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @purpose_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different purposes -- @1.2        # features/pay_to_church/17_churchPayment.feature:496
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with purpose "Tithe"                # steps/church_payment_steps.py:66
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @purpose_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different purposes -- @1.3        # features/pay_to_church/17_churchPayment.feature:497
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with purpose "Building Fund"        # steps/church_payment_steps.py:66
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @purpose_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different purposes -- @1.4        # features/pay_to_church/17_churchPayment.feature:498
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with purpose "Mission Support"      # steps/church_payment_steps.py:66
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @purpose_validation @pay_to_church @sasai
  Scenario Outline: Church payment with different purposes -- @1.5        # features/pay_to_church/17_churchPayment.feature:499
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with purpose "Special Collection"   # steps/church_payment_steps.py:66
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @device_info @pay_to_church @sasai
  Scenario: Church payment with complete device information               # features/pay_to_church/17_churchPayment.feature:502
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have all required device headers                                # steps/school_payment_options_steps.py:44
    And I have complete device information in payload                     # steps/church_payment_steps.py:267
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @extract_data @pay_to_church @sasai
  Scenario: Extract payment confirmation details                          # features/pay_to_church/17_churchPayment.feature:511
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details                                     # steps/church_payment_steps.py:18
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116
    And I extract transaction ID from payment response                    # steps/church_payment_steps.py:499
    And I extract payment status from payment response                    # steps/church_payment_steps.py:514
    And extracted payment details should not be empty                     # steps/church_payment_steps.py:529

  @church_payment @payment_method @pay_to_church @sasai
  Scenario: Church payment with wallet payment method                     # features/pay_to_church/17_churchPayment.feature:522
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with payment method "wallet"        # steps/church_payment_steps.py:235
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @provider_validation @pay_to_church @sasai
  Scenario: Church payment with ecocash provider                          # features/pay_to_church/17_churchPayment.feature:530
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with provider "ecocash"             # steps/church_payment_steps.py:243
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @subtype_validation @pay_to_church @sasai
  Scenario: Verify pay-to-church subtype is required                      # features/pay_to_church/17_churchPayment.feature:538
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with subtype "pay-to-church"        # steps/church_payment_steps.py:251
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

  @church_payment @channel_validation @pay_to_church @sasai
  Scenario: Church payment with sasai-super-app channel                   # features/pay_to_church/17_churchPayment.feature:546
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have church payment details with channel "sasai-super-app"      # steps/church_payment_steps.py:259
    And I have device information headers                                 # steps/school_payment_options_steps.py:27
    When I send church payment request to "/bff/v2/order/utility/payment" # steps/church_payment_steps.py:281
    Then response status code should be 200                               # steps/common_steps.py:116

Feature: Pay to Merchant- Lookup # features/pay_to_merchants/6_merchantLookup.feature:1
  As a user
  I want to lookup merchant details from Sasai Payment Gateway API
  So that I can verify merchant information before making a payment
  Background:   # features/pay_to_merchants/6_merchantLookup.feature:10

  @smoke @merchant_lookup @pay_to_merchant @sasai
  Scenario: Lookup merchant with valid parameters                                                         # features/pay_to_merchants/6_merchantLookup.feature:16
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 200                                                               # steps/common_steps.py:116
    And response time should be less than 5000 ms                                                         # steps/common_steps.py:169
    And response should contain merchant details                                                          # steps/merchant_lookup_steps.py:339

  @merchant_lookup @positive @pay_to_merchant @sasai
  Scenario: Lookup merchant with all required query parameters    # features/pay_to_merchants/6_merchantLookup.feature:25
    Given API is available                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification             # steps/login_devices_steps.py:9
    Given I have valid user authentication                        # steps/login_devices_steps.py:92
    And I have merchant category "SZWC10002"                      # steps/merchant_lookup_steps.py:43
    And I have operator ID "SZWOM00001"                           # steps/merchant_lookup_steps.py:52
    And I have country code "ZW"                                  # steps/otp_steps.py:60
    And I have merchant ID "52869750-4e6f-4bb9-9d45-cc401f0da123" # steps/merchant_lookup_steps.py:61
    And I have currency "USD"                                     # steps/merchant_lookup_steps.py:72
    And I have Q1 value "001535"                                  # steps/merchant_lookup_steps.py:83
    When I send merchant lookup request with query parameters     # steps/merchant_lookup_steps.py:270
    Then response status code should be 200                       # steps/common_steps.py:116
    And response should contain merchant details                  # steps/merchant_lookup_steps.py:339

  @merchant_lookup @positive @pay_to_merchant @sasai
  Scenario: Lookup merchant with valid requestId header                                                   # features/pay_to_merchants/6_merchantLookup.feature:38
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"                                          # steps/merchant_lookup_steps.py:94
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 200                                                               # steps/common_steps.py:116
    And response should contain merchant details                                                          # steps/merchant_lookup_steps.py:339

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant without authentication                                                        # features/pay_to_merchants/6_merchantLookup.feature:47
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have no authentication token                                                                  # steps/login_devices_steps.py:100
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 401                                                               # steps/common_steps.py:116

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with app token instead of user token                                          # features/pay_to_merchants/6_merchantLookup.feature:54
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have app token only                                                                           # steps/login_devices_steps.py:108
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 401 or 403                                                        # steps/common_steps.py:123

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with expired user token                                                       # features/pay_to_merchants/6_merchantLookup.feature:61
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have expired user token                                                                       # steps/login_devices_steps.py:115
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 401                                                               # steps/common_steps.py:116

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with invalid user token                                                       # features/pay_to_merchants/6_merchantLookup.feature:68
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have invalid user token                                                                       # steps/login_devices_steps.py:123
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 401                                                               # steps/common_steps.py:116

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with invalid category ID          # features/pay_to_merchants/6_merchantLookup.feature:75
    Given API is available                                    # steps/common_steps.py:9
    And I am authenticated with valid app token               # steps/otp_steps.py:9
    And I have valid user token from PIN verification         # steps/login_devices_steps.py:9
    Given I have valid user authentication                    # steps/login_devices_steps.py:92
    And I have invalid merchant category "INVALID_CAT"        # steps/merchant_lookup_steps.py:103
    And I have operator ID "SZWOM00001"                       # steps/merchant_lookup_steps.py:52
    When I send merchant lookup request with query parameters # steps/merchant_lookup_steps.py:270
    Then response status code should be 400 or 404            # steps/common_steps.py:123

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with invalid operator ID          # features/pay_to_merchants/6_merchantLookup.feature:83
    Given API is available                                    # steps/common_steps.py:9
    And I am authenticated with valid app token               # steps/otp_steps.py:9
    And I have valid user token from PIN verification         # steps/login_devices_steps.py:9
    Given I have valid user authentication                    # steps/login_devices_steps.py:92
    And I have merchant category "SZWC10002"                  # steps/merchant_lookup_steps.py:43
    And I have invalid operator ID "INVALID_OP"               # steps/merchant_lookup_steps.py:112
    When I send merchant lookup request with query parameters # steps/merchant_lookup_steps.py:270
    Then response status code should be 400 or 404            # steps/common_steps.py:123

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with missing country code                                                     # features/pay_to_merchants/6_merchantLookup.feature:91
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters without country code                                            # steps/merchant_lookup_steps.py:154
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 400                                                               # steps/common_steps.py:116

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with invalid country code                                                     # features/pay_to_merchants/6_merchantLookup.feature:98
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    And I have invalid country code "XX"                                                                  # steps/merchant_lookup_steps.py:121
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 400                                                               # steps/common_steps.py:116

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with missing merchant ID                                                      # features/pay_to_merchants/6_merchantLookup.feature:106
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters without merchant ID                                             # steps/merchant_lookup_steps.py:174
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 400                                                               # steps/common_steps.py:116

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with invalid merchant ID                                                      # features/pay_to_merchants/6_merchantLookup.feature:113
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    And I have invalid merchant ID "invalid-merchant-id"                                                  # steps/merchant_lookup_steps.py:132
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 400 or 404                                                        # steps/common_steps.py:123

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with missing currency                                                         # features/pay_to_merchants/6_merchantLookup.feature:121
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters without currency                                                # steps/merchant_lookup_steps.py:194
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 400                                                               # steps/common_steps.py:116

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with invalid currency                                                         # features/pay_to_merchants/6_merchantLookup.feature:128
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    And I have invalid currency "XXX"                                                                     # steps/merchant_lookup_steps.py:143
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 400                                                               # steps/common_steps.py:116

  @merchant_lookup @negative @pay_to_merchant @sasai
  Scenario: Lookup merchant with missing Q1 parameter                                                     # features/pay_to_merchants/6_merchantLookup.feature:136
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters without Q1                                                      # steps/merchant_lookup_steps.py:214
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 400                                                               # steps/common_steps.py:116

  @merchant_lookup @validation @pay_to_merchant @sasai
  Scenario: Verify merchant lookup response structure                                                     # features/pay_to_merchants/6_merchantLookup.feature:143
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 200                                                               # steps/common_steps.py:116
    And response body should be valid JSON                                                                # steps/common_steps.py:139
    And response should contain merchant information fields                                               # steps/merchant_lookup_steps.py:356

  @merchant_lookup @validation @pay_to_merchant @sasai
  Scenario: Verify merchant lookup response contains required fields                                      # features/pay_to_merchants/6_merchantLookup.feature:152
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 200                                                               # steps/common_steps.py:116
    And merchant details should have required fields                                                      # steps/merchant_lookup_steps.py:370

  @merchant_lookup @headers @validation @pay_to_merchant @sasai
  Scenario: Verify merchant lookup response headers                                                       # features/pay_to_merchants/6_merchantLookup.feature:160
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 200                                                               # steps/common_steps.py:116
    And response header "Content-Type" should be present                                                  # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"                                  # steps/common_steps.py:229

  @merchant_lookup @headers @validation @pay_to_merchant @sasai
  Scenario: Verify merchant lookup has required headers                                                   # features/pay_to_merchants/6_merchantLookup.feature:169
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 200                                                               # steps/common_steps.py:116
    And response header "Content-Type" should not be empty                                                # steps/common_steps.py:243
    And response header "Date" should be present                                                          # steps/common_steps.py:206

  @merchant_lookup @security @pay_to_merchant @sasai
  Scenario: Verify merchant lookup with missing Authorization header                                      # features/pay_to_merchants/6_merchantLookup.feature:178
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have no Authorization header                                                                  # steps/login_devices_steps.py:139
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 401                                                               # steps/common_steps.py:116

  @merchant_lookup @security @pay_to_merchant @sasai
  Scenario: Verify merchant lookup with empty Bearer token                                                # features/pay_to_merchants/6_merchantLookup.feature:185
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                                                       # steps/login_devices_steps.py:146
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 401                                                               # steps/common_steps.py:116

  @merchant_lookup @security @pay_to_merchant @sasai
  Scenario: Verify merchant lookup without Bearer prefix                                                  # features/pay_to_merchants/6_merchantLookup.feature:192
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have token without Bearer prefix                                                              # steps/login_devices_steps.py:154
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 401                                                               # steps/common_steps.py:116

  @merchant_lookup @security @pay_to_merchant @sasai
  Scenario: Verify merchant lookup with malformed Bearer token                                            # features/pay_to_merchants/6_merchantLookup.feature:199
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                                                   # steps/login_devices_steps.py:131
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 401                                                               # steps/common_steps.py:116

  @merchant_lookup @error_handling @pay_to_merchant @sasai
  Scenario: Lookup merchant with invalid HTTP method                                           # features/pay_to_merchants/6_merchantLookup.feature:206
    Given API is available                                                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                                                # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                          # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                     # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                      # steps/merchant_lookup_steps.py:17
    When I send POST request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/common_steps.py:28
    Then response status code should be 405                                                    # steps/common_steps.py:116

  @merchant_lookup @error_handling @pay_to_merchant @sasai
  Scenario: Lookup merchant with wrong endpoint path                                           # features/pay_to_merchants/6_merchantLookup.feature:213
    Given API is available                                                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                                                # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                          # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                     # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                      # steps/merchant_lookup_steps.py:17
    When I send GET request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookups" # steps/common_steps.py:50
    Then response status code should be 404                                                    # steps/common_steps.py:116

  @merchant_lookup @performance @pay_to_merchant @sasai
  Scenario: Verify merchant lookup response time                                                          # features/pay_to_merchants/6_merchantLookup.feature:220
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 200                                                               # steps/common_steps.py:116
    And response time should be less than 3000 ms                                                         # steps/common_steps.py:169

  @merchant_lookup @integration @pay_to_merchant @sasai
  Scenario: Complete flow - PIN Verify to Merchant Lookup                                                                   # features/pay_to_merchants/6_merchantLookup.feature:228
    Given API is available                                                                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                                                                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                                       # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                                                             # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                                                       # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                                                 # steps/common_steps.py:116
    And I store the user token from response                                                                                # steps/login_devices_steps.py:260
    Given I have merchant lookup parameters                                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request with stored token to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:307
    Then response status code should be 200                                                                                 # steps/common_steps.py:116
    And response should contain merchant details                                                                            # steps/merchant_lookup_steps.py:339

Feature: Pay to Merchant- Payment Options # features/pay_to_merchants/7_paymentOptions.feature:1
  As a user
  I want to verify payment options from Sasai Payment Gateway API
  So that I can see available payment methods before making a merchant payment
  Background:   # features/pay_to_merchants/7_paymentOptions.feature:10

  @smoke @payment_options @merchant_payment @sasai
  Scenario: Verify payment options with valid parameters             # features/pay_to_merchants/7_paymentOptions.feature:16
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 200                          # steps/common_steps.py:116
    And response time should be less than 5000 ms                    # steps/common_steps.py:169
    And response should contain payment options                      # steps/payment_options_steps.py:160

  @payment_options @positive @merchant_payment @sasai
  Scenario: Get payment options with sasai-app-payment service type  # features/pay_to_merchants/7_paymentOptions.feature:25
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"     # steps/merchant_lookup_steps.py:94
    When I send payment options request with query parameters        # steps/payment_options_steps.py:98
    Then response status code should be 200                          # steps/common_steps.py:116
    And response should contain payment options                      # steps/payment_options_steps.py:160
    And response should contain payment methods                      # steps/payment_options_steps.py:214

  @payment_options @positive @merchant_payment @sasai
  Scenario: Get payment options with valid requestId header              # features/pay_to_merchants/7_paymentOptions.feature:35
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                               # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                          # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"         # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"     # steps/payment_options_steps.py:70
    Then response status code should be 200                              # steps/common_steps.py:116
    And response header "Content-Type" should contain "application/json" # steps/common_steps.py:229
    And response should contain payment options                          # steps/payment_options_steps.py:160

  @payment_options @negative @merchant_payment @sasai
  Scenario: Get payment options without authentication               # features/pay_to_merchants/7_paymentOptions.feature:45
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have no authentication token                             # steps/login_devices_steps.py:100
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 401                          # steps/common_steps.py:116

  @payment_options @negative @merchant_payment @sasai
  Scenario: Get payment options with app token instead of user token  # features/pay_to_merchants/7_paymentOptions.feature:52
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have app token only                                       # steps/login_devices_steps.py:108
    And I have service type "sasai-app-payment"                       # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options"  # steps/payment_options_steps.py:70
    Then response status code should be 401 or 403                    # steps/common_steps.py:123

  @payment_options @negative @merchant_payment @sasai
  Scenario: Get payment options with expired user token              # features/pay_to_merchants/7_paymentOptions.feature:59
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have expired user token                                  # steps/login_devices_steps.py:115
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 401                          # steps/common_steps.py:116

  @payment_options @negative @merchant_payment @sasai
  Scenario: Get payment options with invalid user token              # features/pay_to_merchants/7_paymentOptions.feature:66
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have invalid user token                                  # steps/login_devices_steps.py:123
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 401                          # steps/common_steps.py:116

  @payment_options @negative @merchant_payment @sasai
  Scenario: Get payment options with missing service type            # features/pay_to_merchants/7_paymentOptions.feature:73
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have no service type parameter                             # steps/payment_options_steps.py:30
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 400                          # steps/common_steps.py:116

  @payment_options @negative @merchant_payment @sasai
  Scenario: Get payment options with invalid service type     # features/pay_to_merchants/7_paymentOptions.feature:80
    Given API is available                                    # steps/common_steps.py:9
    And I am authenticated with valid app token               # steps/otp_steps.py:9
    And I have valid user token from PIN verification         # steps/login_devices_steps.py:9
    Given I have valid user authentication                    # steps/login_devices_steps.py:92
    And I have invalid service type "invalid-service"         # steps/payment_options_steps.py:40
    When I send payment options request with query parameters # steps/payment_options_steps.py:98
    Then response status code should be 400                   # steps/common_steps.py:116

  @payment_options @negative @merchant_payment @sasai
  Scenario: Get payment options with empty service type       # features/pay_to_merchants/7_paymentOptions.feature:87
    Given API is available                                    # steps/common_steps.py:9
    And I am authenticated with valid app token               # steps/otp_steps.py:9
    And I have valid user token from PIN verification         # steps/login_devices_steps.py:9
    Given I have valid user authentication                    # steps/login_devices_steps.py:92
    And I have empty service type                             # steps/payment_options_steps.py:54
    When I send payment options request with query parameters # steps/payment_options_steps.py:98
    Then response status code should be 400                   # steps/common_steps.py:116

  @payment_options @validation @merchant_payment @sasai
  Scenario: Verify payment options response structure                # features/pay_to_merchants/7_paymentOptions.feature:94
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 200                          # steps/common_steps.py:116
    And response body should be valid JSON                           # steps/common_steps.py:139
    And response should have payment options structure               # steps/payment_options_steps.py:249

  @payment_options @validation @merchant_payment @sasai
  Scenario: Verify payment options contains required fields          # features/pay_to_merchants/7_paymentOptions.feature:103
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 200                          # steps/common_steps.py:116
    And payment options should have required fields                  # steps/payment_options_steps.py:263

  @payment_options @validation @merchant_payment @sasai
  Scenario: Verify payment methods are available                     # features/pay_to_merchants/7_paymentOptions.feature:111
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 200                          # steps/common_steps.py:116
    And response should contain at least one payment method          # steps/payment_options_steps.py:289

  @payment_options @headers @validation @merchant_payment @sasai
  Scenario: Verify payment options response headers                      # features/pay_to_merchants/7_paymentOptions.feature:119
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                               # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                          # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options"     # steps/payment_options_steps.py:70
    Then response status code should be 200                              # steps/common_steps.py:116
    And response header "Content-Type" should be present                 # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json" # steps/common_steps.py:229

  @payment_options @headers @validation @merchant_payment @sasai
  Scenario: Verify payment options has required headers              # features/pay_to_merchants/7_paymentOptions.feature:128
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 200                          # steps/common_steps.py:116
    And response header "Content-Type" should not be empty           # steps/common_steps.py:243
    And response header "Date" should be present                     # steps/common_steps.py:206

  @payment_options @security @merchant_payment @sasai
  Scenario: Verify payment options with missing Authorization header  # features/pay_to_merchants/7_paymentOptions.feature:137
    Given API is available                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                 # steps/login_devices_steps.py:9
    Given I have no Authorization header                              # steps/login_devices_steps.py:139
    And I have service type "sasai-app-payment"                       # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options"  # steps/payment_options_steps.py:70
    Then response status code should be 401                           # steps/common_steps.py:116

  @payment_options @security @merchant_payment @sasai
  Scenario: Verify payment options with empty Bearer token           # features/pay_to_merchants/7_paymentOptions.feature:144
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                  # steps/login_devices_steps.py:146
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 401                          # steps/common_steps.py:116

  @payment_options @security @merchant_payment @sasai
  Scenario: Verify payment options without Bearer prefix             # features/pay_to_merchants/7_paymentOptions.feature:151
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have token without Bearer prefix                         # steps/login_devices_steps.py:154
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 401                          # steps/common_steps.py:116

  @payment_options @security @merchant_payment @sasai
  Scenario: Verify payment options with malformed Bearer token       # features/pay_to_merchants/7_paymentOptions.feature:158
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                              # steps/login_devices_steps.py:131
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 401                          # steps/common_steps.py:116

  @payment_options @error_handling @merchant_payment @sasai
  Scenario: Get payment options with invalid HTTP method  # features/pay_to_merchants/7_paymentOptions.feature:165
    Given API is available                                # steps/common_steps.py:9
    And I am authenticated with valid app token           # steps/otp_steps.py:9
    And I have valid user token from PIN verification     # steps/login_devices_steps.py:9
    Given I have valid user authentication                # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"           # steps/payment_options_steps.py:16
    When I send POST request to "/bff/v1/payment/options" # steps/common_steps.py:28
    Then response status code should be 405               # steps/common_steps.py:116

  @payment_options @error_handling @merchant_payment @sasai
  Scenario: Get payment options with wrong endpoint path  # features/pay_to_merchants/7_paymentOptions.feature:172
    Given API is available                                # steps/common_steps.py:9
    And I am authenticated with valid app token           # steps/otp_steps.py:9
    And I have valid user token from PIN verification     # steps/login_devices_steps.py:9
    Given I have valid user authentication                # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"           # steps/payment_options_steps.py:16
    When I send GET request to "/bff/v1/payment/option"   # steps/common_steps.py:50
    Then response status code should be 404               # steps/common_steps.py:116

  @payment_options @performance @merchant_payment @sasai
  Scenario: Verify payment options response time                     # features/pay_to_merchants/7_paymentOptions.feature:179
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 200                          # steps/common_steps.py:116
    And response time should be less than 3000 ms                    # steps/common_steps.py:169

  @payment_options @integration @merchant_payment @sasai
  Scenario: Complete flow - PIN Verify to Payment Options                              # features/pay_to_merchants/7_paymentOptions.feature:187
    Given API is available                                                             # steps/common_steps.py:9
    And I am authenticated with valid app token                                        # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                  # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                        # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                  # steps/pin_verify_steps.py:222
    Then response status code should be 200                                            # steps/common_steps.py:116
    And I store the user token from response                                           # steps/login_devices_steps.py:260
    Given I have service type "sasai-app-payment"                                      # steps/payment_options_steps.py:16
    When I send payment options request with stored token to "/bff/v1/payment/options" # steps/payment_options_steps.py:127
    Then response status code should be 200                                            # steps/common_steps.py:116
    And response should contain payment options                                        # steps/payment_options_steps.py:160

  @payment_options @integration @merchant_payment @sasai
  Scenario: Complete merchant payment flow - Merchant Lookup to Payment Options                           # features/pay_to_merchants/7_paymentOptions.feature:198
    Given API is available                                                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                                                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                                # steps/login_devices_steps.py:92
    And I have merchant lookup parameters                                                                 # steps/merchant_lookup_steps.py:17
    When I send merchant lookup request to "/catalog/v1/categories/SZWC10002/operators/SZWOM00001/lookup" # steps/merchant_lookup_steps.py:238
    Then response status code should be 200                                                               # steps/common_steps.py:116
    And response should contain merchant details                                                          # steps/merchant_lookup_steps.py:339
    Given I have service type "sasai-app-payment"                                                         # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options"                                      # steps/payment_options_steps.py:70
    Then response status code should be 200                                                               # steps/common_steps.py:116
    And response should contain payment options                                                           # steps/payment_options_steps.py:160
    And response should contain payment methods                                                           # steps/payment_options_steps.py:214

Feature: Pay to Merchant- Payment # features/pay_to_merchants/8_utilityPayment.feature:1
  As a user
  I want to make utility payments through Sasai Payment Gateway API
  So that I can complete merchant payments for utility services
  Background:   # features/pay_to_merchants/8_utilityPayment.feature:10

  @smoke @utility_payment @merchant_payment @sasai
  Scenario: Create utility payment with valid parameters                   # features/pay_to_merchants/8_utilityPayment.feature:22
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 200                                # steps/common_steps.py:116
    And response time should be less than 10000 ms                         # steps/common_steps.py:169
    And response should contain payment confirmation                       # steps/church_payment_steps.py:351

  @utility_payment @positive @merchant_payment @sasai
  Scenario: Create utility payment with all required fields          # features/pay_to_merchants/8_utilityPayment.feature:31
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    And I have valid user authentication                             # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"     # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 200                          # steps/common_steps.py:116
    And response should contain payment options                      # steps/payment_options_steps.py:160
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have fee amount 0                                          # steps/utility_payment_steps.py:72
    And I have currency "USD"                                        # steps/merchant_lookup_steps.py:72
    And I have biller details for utility payment                    # steps/utility_payment_steps.py:84
    And I have payer amount 7                                        # steps/utility_payment_steps.py:106
    And I have payer details with encrypted PIN                      # steps/utility_payment_steps.py:123
    And I have payment subtype "merchant-pay"                        # steps/utility_payment_steps.py:144
    And I have channel "sasai-super-app"                             # steps/utility_payment_steps.py:156
    And I have device information                                    # steps/utility_payment_steps.py:168
    When I send utility payment request with complete body           # steps/utility_payment_steps.py:345
    Then response status code should be 200                          # steps/common_steps.py:116
    And response should contain payment confirmation                 # steps/church_payment_steps.py:351
    And response should contain transaction ID                       # steps/utility_payment_steps.py:386

  @utility_payment @positive @merchant_payment @sasai
  Scenario: Create utility payment with notes field                        # features/pay_to_merchants/8_utilityPayment.feature:47
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    And I have payment notes                                               # steps/utility_payment_steps.py:193
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment confirmation                       # steps/church_payment_steps.py:351

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment without authentication                  # features/pay_to_merchants/8_utilityPayment.feature:56
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have no authentication token                                   # steps/login_devices_steps.py:100
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 401                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with app token instead of user token    # features/pay_to_merchants/8_utilityPayment.feature:63
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have app token only                                            # steps/login_devices_steps.py:108
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 401 or 403                         # steps/common_steps.py:123

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with expired user token                 # features/pay_to_merchants/8_utilityPayment.feature:70
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have expired user token                                        # steps/login_devices_steps.py:115
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 401                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with invalid user token                 # features/pay_to_merchants/8_utilityPayment.feature:77
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have invalid user token                                        # steps/login_devices_steps.py:123
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 401                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with missing biller details             # features/pay_to_merchants/8_utilityPayment.feature:84
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request without biller details              # steps/utility_payment_steps.py:209
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with missing payer details              # features/pay_to_merchants/8_utilityPayment.feature:91
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request without payer details               # steps/utility_payment_steps.py:219
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with invalid currency                   # features/pay_to_merchants/8_utilityPayment.feature:98
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    And I have invalid currency "XXX"                                      # steps/merchant_lookup_steps.py:143
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with missing encrypted PIN              # features/pay_to_merchants/8_utilityPayment.feature:106
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request without encrypted PIN               # steps/utility_payment_steps.py:229
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with invalid encrypted PIN              # features/pay_to_merchants/8_utilityPayment.feature:113
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    And I have invalid payment PIN "invalid_pin_12345"                     # steps/utility_payment_steps.py:240
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400 or 401                         # steps/common_steps.py:123

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with missing payment method             # features/pay_to_merchants/8_utilityPayment.feature:121
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request without payment method              # steps/utility_payment_steps.py:254
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with invalid payment method             # features/pay_to_merchants/8_utilityPayment.feature:128
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    And I have invalid payment method "invalid-method"                     # steps/utility_payment_steps.py:265
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with missing amount                     # features/pay_to_merchants/8_utilityPayment.feature:136
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request without amount                      # steps/utility_payment_steps.py:279
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with zero amount                        # features/pay_to_merchants/8_utilityPayment.feature:143
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    And I have payer amount 0                                              # steps/utility_payment_steps.py:106
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @negative @merchant_payment @sasai
  Scenario: Create utility payment with negative amount                    # features/pay_to_merchants/8_utilityPayment.feature:151
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    And I have payer amount -10                                            # steps/utility_payment_steps.py:106
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @validation @merchant_payment @sasai
  Scenario: Verify utility payment response structure                      # features/pay_to_merchants/8_utilityPayment.feature:159
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 200                                # steps/common_steps.py:116
    And response body should be valid JSON                                 # steps/common_steps.py:139
    And response should have payment structure                             # steps/church_payment_steps.py:398

  @utility_payment @validation @merchant_payment @sasai
  Scenario: Verify utility payment response contains required fields       # features/pay_to_merchants/8_utilityPayment.feature:168
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 200                                # steps/common_steps.py:116
    And payment response should have required fields                       # steps/church_payment_steps.py:410

  @utility_payment @validation @merchant_payment @sasai
  Scenario: Verify utility payment response contains transaction ID        # features/pay_to_merchants/8_utilityPayment.feature:176
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain transaction ID                             # steps/utility_payment_steps.py:386

  @utility_payment @headers @validation @merchant_payment @sasai
  Scenario: Verify utility payment response headers                        # features/pay_to_merchants/8_utilityPayment.feature:184
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 200                                # steps/common_steps.py:116
    And response header "Content-Type" should be present                   # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"   # steps/common_steps.py:229

  @utility_payment @security @merchant_payment @sasai
  Scenario: Verify utility payment with missing Authorization header       # features/pay_to_merchants/8_utilityPayment.feature:193
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have no Authorization header                                   # steps/login_devices_steps.py:139
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 401                                # steps/common_steps.py:116

  @utility_payment @security @merchant_payment @sasai
  Scenario: Verify utility payment with empty Bearer token                 # features/pay_to_merchants/8_utilityPayment.feature:200
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have empty Bearer token                                        # steps/login_devices_steps.py:146
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 401                                # steps/common_steps.py:116

  @utility_payment @security @merchant_payment @sasai
  Scenario: Verify utility payment with malformed Bearer token             # features/pay_to_merchants/8_utilityPayment.feature:207
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have malformed Bearer token                                    # steps/login_devices_steps.py:131
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 401                                # steps/common_steps.py:116

  @utility_payment @error_handling @merchant_payment @sasai
  Scenario: Create utility payment with invalid HTTP method          # features/pay_to_merchants/8_utilityPayment.feature:214
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    And I have valid user authentication                             # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"     # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 200                          # steps/common_steps.py:116
    And response should contain payment options                      # steps/payment_options_steps.py:160
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have utility payment request body                          # steps/utility_payment_steps.py:17
    When I send GET request to "/bff/v2/order/utility/payment"       # steps/common_steps.py:50
    Then response status code should be 405                          # steps/common_steps.py:116

  @utility_payment @error_handling @merchant_payment @sasai
  Scenario: Create utility payment with wrong endpoint path          # features/pay_to_merchants/8_utilityPayment.feature:221
    Given API is available                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                # steps/login_devices_steps.py:9
    And I have valid user authentication                             # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                      # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"     # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options" # steps/payment_options_steps.py:70
    Then response status code should be 200                          # steps/common_steps.py:116
    And response should contain payment options                      # steps/payment_options_steps.py:160
    Given I have valid user authentication                           # steps/login_devices_steps.py:92
    And I have utility payment request body                          # steps/utility_payment_steps.py:17
    When I send POST request to "/bff/v2/order/utility/payments"     # steps/common_steps.py:28
    Then response status code should be 404                          # steps/common_steps.py:116

  @utility_payment @error_handling @merchant_payment @sasai
  Scenario: Create utility payment with malformed JSON body                # features/pay_to_merchants/8_utilityPayment.feature:228
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have malformed JSON request body                                 # steps/utility_payment_steps.py:291
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 400                                # steps/common_steps.py:116

  @utility_payment @performance @merchant_payment @sasai
  Scenario: Verify utility payment response time                           # features/pay_to_merchants/8_utilityPayment.feature:235
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    And I have valid user authentication                                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                            # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"           # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"       # steps/payment_options_steps.py:70
    Then response status code should be 200                                # steps/common_steps.py:116
    And response should contain payment options                            # steps/payment_options_steps.py:160
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have utility payment request body                                # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:304
    Then response status code should be 200                                # steps/common_steps.py:116
    And response time should be less than 8000 ms                          # steps/common_steps.py:169

  @utility_payment @integration @merchant_payment @sasai
  Scenario: Complete flow - PIN Verify to Utility Payment                                    # features/pay_to_merchants/8_utilityPayment.feature:243
    Given API is available                                                                   # steps/common_steps.py:9
    And I am authenticated with valid app token                                              # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                        # steps/login_devices_steps.py:9
    And I have valid user authentication                                                     # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                                              # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"                             # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"                         # steps/payment_options_steps.py:70
    Then response status code should be 200                                                  # steps/common_steps.py:116
    And response should contain payment options                                              # steps/payment_options_steps.py:160
    Given I have valid PIN verification details                                              # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                        # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                  # steps/common_steps.py:116
    And I store the user token from response                                                 # steps/login_devices_steps.py:260
    Given I have utility payment request body                                                # steps/utility_payment_steps.py:17
    When I send utility payment request with stored token to "/bff/v2/order/utility/payment" # steps/utility_payment_steps.py:353
    Then response status code should be 200                                                  # steps/common_steps.py:116
    And response should contain payment confirmation                                         # steps/church_payment_steps.py:351

  @utility_payment @integration @merchant_payment @sasai
  Scenario: Complete merchant payment flow - Payment Options to Utility Payment  # features/pay_to_merchants/8_utilityPayment.feature:254
    Given API is available                                                       # steps/common_steps.py:9
    And I am authenticated with valid app token                                  # steps/otp_steps.py:9
    And I have valid user token from PIN verification                            # steps/login_devices_steps.py:9
    And I have valid user authentication                                         # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                                  # steps/payment_options_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f"                 # steps/merchant_lookup_steps.py:94
    When I send payment options request to "/bff/v1/payment/options"             # steps/payment_options_steps.py:70
    Then response status code should be 200                                      # steps/common_steps.py:116
    And response should contain payment options                                  # steps/payment_options_steps.py:160
    Given I have valid user authentication                                       # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                                  # steps/payment_options_steps.py:16
    When I send payment options request to "/bff/v1/payment/options"             # steps/payment_options_steps.py:70
    Then response status code should be 200                                      # steps/common_steps.py:116
    And response should contain payment options                                  # steps/payment_options_steps.py:160
    Given I have utility payment request body                                    # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment"       # steps/utility_payment_steps.py:304
    Then response status code should be 200                                      # steps/common_steps.py:116
    And response should contain payment confirmation                             # steps/church_payment_steps.py:351
    And response should contain transaction ID                                   # steps/utility_payment_steps.py:386

Feature: Pay to Merchant- Order Details # features/pay_to_merchants/9_orderDetails.feature:1
  As a user
  I want to retrieve order details from Sasai Payment Gateway API
  So that I can view payment details that were completed in the merchant flow
  Background:   # features/pay_to_merchants/9_orderDetails.feature:10

  @smoke @order_details @merchant_payment @sasai
  Scenario: Get order details with valid order reference                            # features/pay_to_merchants/9_orderDetails.feature:16
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have valid user authentication                                          # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 200                                         # steps/common_steps.py:116
    And response time should be less than 5000 ms                                   # steps/common_steps.py:169
    And response should contain order details                                       # steps/order_details_steps.py:259

  @order_details @positive @merchant_payment @sasai
  Scenario: Get order details for completed payment   # features/pay_to_merchants/9_orderDetails.feature:25
    Given API is available                            # steps/common_steps.py:9
    And I am authenticated with valid app token       # steps/otp_steps.py:9
    And I have valid user token from PIN verification # steps/login_devices_steps.py:9
    Given I have valid user authentication            # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"   # steps/order_details_steps.py:16
    When I send GET request to order details endpoint # steps/order_details_steps.py:85
    Then response status code should be 200           # steps/common_steps.py:116
    And response should contain order details         # steps/order_details_steps.py:259
    And response should contain order status          # steps/order_details_steps.py:275

  @order_details @positive @merchant_payment @sasai
  Scenario: Get order details with request ID header             # features/pay_to_merchants/9_orderDetails.feature:34
    Given API is available                                       # steps/common_steps.py:9
    And I am authenticated with valid app token                  # steps/otp_steps.py:9
    And I have valid user token from PIN verification            # steps/login_devices_steps.py:9
    Given I have valid user authentication                       # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"              # steps/order_details_steps.py:16
    And I have request ID "bdefac7b-bbc0-48b4-9ef0-84e6b9b34a6f" # steps/merchant_lookup_steps.py:94
    When I send order details request with headers               # steps/order_details_steps.py:113
    Then response status code should be 200                      # steps/common_steps.py:116
    And response should contain order details                    # steps/order_details_steps.py:259

  @order_details @negative @merchant_payment @sasai
  Scenario: Get order details without authentication                                # features/pay_to_merchants/9_orderDetails.feature:43
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have no authentication token                                            # steps/login_devices_steps.py:100
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 401                                         # steps/common_steps.py:116

  @order_details @negative @merchant_payment @sasai
  Scenario: Get order details with app token instead of user token                  # features/pay_to_merchants/9_orderDetails.feature:50
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have app token only                                                     # steps/login_devices_steps.py:108
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 401 or 403                                  # steps/common_steps.py:123

  @order_details @negative @merchant_payment @sasai
  Scenario: Get order details with expired user token                               # features/pay_to_merchants/9_orderDetails.feature:57
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have expired user token                                                 # steps/login_devices_steps.py:115
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 401                                         # steps/common_steps.py:116

  @order_details @negative @merchant_payment @sasai
  Scenario: Get order details with invalid user token                               # features/pay_to_merchants/9_orderDetails.feature:64
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have invalid user token                                                 # steps/login_devices_steps.py:123
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 401                                         # steps/common_steps.py:116

  @order_details @negative @merchant_payment @sasai
  Scenario: Get order details with missing order reference        # features/pay_to_merchants/9_orderDetails.feature:71
    Given API is available                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification             # steps/login_devices_steps.py:9
    Given I have valid user authentication                        # steps/login_devices_steps.py:92
    When I send order details request to "/bff/v2/order/details/" # steps/order_details_steps.py:54
    Then response status code should be 404                       # steps/common_steps.py:116

  @order_details @negative @merchant_payment @sasai
  Scenario: Get order details with invalid order reference format  # features/pay_to_merchants/9_orderDetails.feature:77
    Given API is available                                         # steps/common_steps.py:9
    And I am authenticated with valid app token                    # steps/otp_steps.py:9
    And I have valid user token from PIN verification              # steps/login_devices_steps.py:9
    Given I have valid user authentication                         # steps/login_devices_steps.py:92
    And I have order reference "invalid-format"                    # steps/order_details_steps.py:16
    When I send order details request with invalid reference       # steps/order_details_steps.py:141
    Then response status code should be 400 or 404                 # steps/common_steps.py:123

  @order_details @negative @merchant_payment @sasai
  Scenario: Get order details with non-existent order reference                     # features/pay_to_merchants/9_orderDetails.feature:84
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have valid user authentication                                          # steps/login_devices_steps.py:92
    And I have order reference "999999-9999-999999"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/999999-9999-999999" # steps/order_details_steps.py:54
    Then response status code should be 404                                         # steps/common_steps.py:116

  @order_details @negative @merchant_payment @sasai
  Scenario: Get order details with empty order reference          # features/pay_to_merchants/9_orderDetails.feature:91
    Given API is available                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification             # steps/login_devices_steps.py:9
    Given I have valid user authentication                        # steps/login_devices_steps.py:92
    And I have empty order reference                              # steps/order_details_steps.py:30
    When I send order details request to "/bff/v2/order/details/" # steps/order_details_steps.py:54
    Then response status code should be 404                       # steps/common_steps.py:116

  @order_details @negative @merchant_payment @sasai
  Scenario: Get order details with special characters in reference  # features/pay_to_merchants/9_orderDetails.feature:98
    Given API is available                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification               # steps/login_devices_steps.py:9
    Given I have valid user authentication                          # steps/login_devices_steps.py:92
    And I have order reference "test@#$%^&*()"                      # steps/order_details_steps.py:16
    When I send order details request with special characters       # steps/order_details_steps.py:164
    Then response status code should be 400 or 404                  # steps/common_steps.py:123

  @order_details @validation @merchant_payment @sasai
  Scenario: Verify order details response structure                                 # features/pay_to_merchants/9_orderDetails.feature:105
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have valid user authentication                                          # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 200                                         # steps/common_steps.py:116
    And response body should be valid JSON                                          # steps/common_steps.py:139
    And response should have order structure                                        # steps/order_details_steps.py:291

  @order_details @validation @merchant_payment @sasai
  Scenario: Verify order details response contains required fields                  # features/pay_to_merchants/9_orderDetails.feature:114
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have valid user authentication                                          # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 200                                         # steps/common_steps.py:116
    And order response should have required fields                                  # steps/order_details_steps.py:307

  @order_details @validation @merchant_payment @sasai
  Scenario: Verify order details contains payment information                       # features/pay_to_merchants/9_orderDetails.feature:122
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have valid user authentication                                          # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 200                                         # steps/common_steps.py:116
    And response should contain payment information                                 # steps/order_details_steps.py:323

  @order_details @validation @merchant_payment @sasai
  Scenario: Verify order details contains transaction timestamp                     # features/pay_to_merchants/9_orderDetails.feature:130
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have valid user authentication                                          # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 200                                         # steps/common_steps.py:116
    And response should contain timestamp                                           # steps/order_details_steps.py:339

  @order_details @headers @validation @merchant_payment @sasai
  Scenario: Verify order details response headers                                   # features/pay_to_merchants/9_orderDetails.feature:138
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have valid user authentication                                          # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 200                                         # steps/common_steps.py:116
    And response header "Content-Type" should be present                            # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"            # steps/common_steps.py:229

  @order_details @headers @validation @merchant_payment @sasai
  Scenario: Verify order details accepts request ID header  # features/pay_to_merchants/9_orderDetails.feature:147
    Given API is available                                  # steps/common_steps.py:9
    And I am authenticated with valid app token             # steps/otp_steps.py:9
    And I have valid user token from PIN verification       # steps/login_devices_steps.py:9
    Given I have valid user authentication                  # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"         # steps/order_details_steps.py:16
    And I have request ID "test-request-id-123"             # steps/merchant_lookup_steps.py:94
    When I send order details request with headers          # steps/order_details_steps.py:113
    Then response status code should be 200                 # steps/common_steps.py:116
    And response should contain order details               # steps/order_details_steps.py:259

  @order_details @security @merchant_payment @sasai
  Scenario: Verify order details with missing Authorization header                  # features/pay_to_merchants/9_orderDetails.feature:156
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have no Authorization header                                            # steps/login_devices_steps.py:139
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 401                                         # steps/common_steps.py:116

  @order_details @security @merchant_payment @sasai
  Scenario: Verify order details with empty Bearer token                            # features/pay_to_merchants/9_orderDetails.feature:163
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                                 # steps/login_devices_steps.py:146
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 401                                         # steps/common_steps.py:116

  @order_details @security @merchant_payment @sasai
  Scenario: Verify order details with malformed Bearer token                        # features/pay_to_merchants/9_orderDetails.feature:170
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                             # steps/login_devices_steps.py:131
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 401                                         # steps/common_steps.py:116

  @order_details @security @merchant_payment @sasai
  Scenario: Verify order details for another user's order     # features/pay_to_merchants/9_orderDetails.feature:177
    Given API is available                                    # steps/common_steps.py:9
    And I am authenticated with valid app token               # steps/otp_steps.py:9
    And I have valid user token from PIN verification         # steps/login_devices_steps.py:9
    Given I have valid user authentication                    # steps/login_devices_steps.py:92
    And I have order reference from different user            # steps/order_details_steps.py:40
    When I send order details request to different user order # steps/order_details_steps.py:187
    Then response status code should be 403 or 404            # steps/common_steps.py:123

  @order_details @error_handling @merchant_payment @sasai
  Scenario: Get order details with invalid HTTP method                     # features/pay_to_merchants/9_orderDetails.feature:184
    Given API is available                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                      # steps/login_devices_steps.py:9
    Given I have valid user authentication                                 # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"                        # steps/order_details_steps.py:16
    When I send POST request to "/bff/v2/order/details/176888-6726-665218" # steps/common_steps.py:28
    Then response status code should be 405                                # steps/common_steps.py:116

  @order_details @error_handling @merchant_payment @sasai
  Scenario: Get order details with wrong endpoint path                   # features/pay_to_merchants/9_orderDetails.feature:191
    Given API is available                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                               # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"                      # steps/order_details_steps.py:16
    When I send GET request to "/bff/v2/order/detail/176888-6726-665218" # steps/common_steps.py:50
    Then response status code should be 404                              # steps/common_steps.py:116

  @order_details @performance @merchant_payment @sasai
  Scenario: Verify order details response time                                      # features/pay_to_merchants/9_orderDetails.feature:198
    Given API is available                                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification                               # steps/login_devices_steps.py:9
    Given I have valid user authentication                                          # steps/login_devices_steps.py:92
    And I have order reference "176888-6726-665218"                                 # steps/order_details_steps.py:16
    When I send order details request to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:54
    Then response status code should be 200                                         # steps/common_steps.py:116
    And response time should be less than 3000 ms                                   # steps/common_steps.py:169

  @order_details @integration @merchant_payment @sasai
  Scenario: Complete flow - PIN Verify to Order Details                                               # features/pay_to_merchants/9_orderDetails.feature:206
    Given API is available                                                                            # steps/common_steps.py:9
    And I am authenticated with valid app token                                                       # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                 # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                                       # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                                 # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                           # steps/common_steps.py:116
    And I store the user token from response                                                          # steps/login_devices_steps.py:260
    Given I have order reference "176888-6726-665218"                                                 # steps/order_details_steps.py:16
    When I send order details request with stored token to "/bff/v2/order/details/176888-6726-665218" # steps/order_details_steps.py:210
    Then response status code should be 200                                                           # steps/common_steps.py:116
    And response should contain order details                                                         # steps/order_details_steps.py:259

  @order_details @integration @merchant_payment @sasai
  Scenario: Complete merchant payment flow - Utility Payment to Order Details  # features/pay_to_merchants/9_orderDetails.feature:217
    Given API is available                                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                                # steps/otp_steps.py:9
    And I have valid user token from PIN verification                          # steps/login_devices_steps.py:9
    Given I have valid user authentication                                     # steps/login_devices_steps.py:92
    And I have utility payment request body                                    # steps/utility_payment_steps.py:17
    When I send utility payment request to "/bff/v2/order/utility/payment"     # steps/utility_payment_steps.py:304
    Then response status code should be 200                                    # steps/common_steps.py:116
    And I extract order reference from payment response                        # steps/order_details_steps.py:355
    When I send order details request with extracted reference                 # steps/order_details_steps.py:233
    Then response status code should be 200                                    # steps/common_steps.py:116
    And response should contain order details                                  # steps/order_details_steps.py:259
    And order status should match payment status                               # steps/order_details_steps.py:378

Feature: Pay to School- search # features/pay_to_school/10_schoolSearch.feature:1
  As a user
  I want to search for schools, churches, and merchants
  So that I can make payments to these institutions
  Background:   # features/pay_to_school/10_schoolSearch.feature:11

  @smoke @school_search @pay_to_school @sasai
  Scenario: Search for schools with valid parameters                                     # features/pay_to_school/10_schoolSearch.feature:17
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152
    And response should have pagination info                                             # steps/church_search_steps.py:143

  @school_search @positive @pay_to_school @sasai
  Scenario: Search for churches with valid parameters                                    # features/pay_to_school/10_schoolSearch.feature:29
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "CHURCH"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "church"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152

  @school_search @positive @pay_to_school @sasai
  Scenario: Search for merchants with valid parameters                                   # features/pay_to_school/10_schoolSearch.feature:40
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "MERCHANT"                                                    # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "merchant"                                                     # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152

  @school_search @pagination @pay_to_school @sasai
  Scenario: Search with different page sizes                                             # features/pay_to_school/10_schoolSearch.feature:51
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 5                                                               # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152
    And response should have at most 5 results                                           # steps/school_search_steps.py:164

  @school_search @pagination @pay_to_school @sasai
  Scenario: Search with pagination - page 2                                              # features/pay_to_school/10_schoolSearch.feature:63
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 1                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116

  @school_search @positive @pay_to_school @sasai
  Scenario: Search with minimum query length                                             # features/pay_to_school/10_schoolSearch.feature:73
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "a"                                                            # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116

  @school_search @positive @pay_to_school @sasai
  Scenario: Search with numeric query                                                    # features/pay_to_school/10_schoolSearch.feature:83
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "123"                                                          # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116

  @school_search @negative @pay_to_school @sasai
  Scenario: Search without authentication                                                # features/pay_to_school/10_schoolSearch.feature:93
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have no authentication token                                                 # steps/login_devices_steps.py:100
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 401                                              # steps/common_steps.py:116

  @school_search @negative @pay_to_school @sasai
  Scenario: Search with invalid user token                                               # features/pay_to_school/10_schoolSearch.feature:103
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have invalid user token                                                      # steps/login_devices_steps.py:123
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 401                                              # steps/common_steps.py:116

  @school_search @negative @pay_to_school @sasai
  Scenario: Search with expired user token                                               # features/pay_to_school/10_schoolSearch.feature:113
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have expired user token                                                      # steps/login_devices_steps.py:115
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 401                                              # steps/common_steps.py:116

  @school_search @negative @pay_to_school @sasai
  Scenario: Search with invalid type                                                     # features/pay_to_school/10_schoolSearch.feature:123
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "INVALID_TYPE"                                                # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 400                                              # steps/common_steps.py:116

  @school_search @negative @pay_to_school @sasai
  Scenario: Search with negative page number                                             # features/pay_to_school/10_schoolSearch.feature:133
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number -1                                                            # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 400                                              # steps/common_steps.py:116

  @school_search @negative @pay_to_school @sasai
  Scenario: Search with zero page size                                                   # features/pay_to_school/10_schoolSearch.feature:143
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 0                                                               # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 400                                              # steps/common_steps.py:116

  @school_search @negative @pay_to_school @sasai
  Scenario: Search with negative page size                                        # features/pay_to_school/10_schoolSearch.feature:153
    Given API is available                                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification                             # steps/login_devices_steps.py:9
    Given I have valid user authentication                                        # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                               # steps/school_search_steps.py:21
    And I have page number 0                                                      # steps/school_search_steps.py:28
    And I have page size -10                                                      # steps/school_search_steps.py:35
    And I have name query "school"                                                # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-merchant" # steps/school_search_steps.py:73
    Then response status code should be 400                                       # steps/common_steps.py:116

  @school_search @negative @pay_to_school @sasai
  Scenario: Search with excessive page size                                              # features/pay_to_school/10_schoolSearch.feature:163
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 1000                                                            # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 400                                              # steps/common_steps.py:116

  @school_search @negative @pay_to_school @sasai
  Scenario: Search with empty name query                                                 # features/pay_to_school/10_schoolSearch.feature:173
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query ""/bff/v1/catalog/search-school-church-merchant                                                             # steps/school_search_steps.py:73
    When I send school search request to400bff/v1/catalog/search-school-church-merchant" # steps/common_steps.py:116
    Then response status code should be 400                                              # None

  @school_search @negative @pay_to_school @sasai
  Scenario: Search with missing type parameter                                           # features/pay_to_school/10_schoolSearch.feature:183
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have no search type                                                            # steps/school_search_steps.py:49
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 400                                              # steps/common_steps.py:116

  @school_search @validation @pay_to_school @sasai
  Scenario: Verify search response structure                                             # features/pay_to_school/10_schoolSearch.feature:193
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response body should be valid JSON                                               # steps/common_steps.py:139
    And response should have search structure                                            # steps/church_search_steps.py:187

  @school_search @validation @pay_to_school @sasai
  Scenario: Verify search response contains required fields                              # features/pay_to_school/10_schoolSearch.feature:205
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And search response should have required fields                                      # steps/school_search_steps.py:188

  @school_search @headers @validation @pay_to_school @sasai
  Scenario: Verify search response headers                                               # features/pay_to_school/10_schoolSearch.feature:216
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response header "Content-Type" should be present                                 # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"                 # steps/common_steps.py:229

  @school_search @security @pay_to_school @sasai
  Scenario: Verify search with missing Authorization header                              # features/pay_to_school/10_schoolSearch.feature:228
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have no Authorization header                                                 # steps/login_devices_steps.py:139
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 401                                              # steps/common_steps.py:116

  @school_search @security @pay_to_school @sasai
  Scenario: Verify search with empty Bearer token                                        # features/pay_to_school/10_schoolSearch.feature:238
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                                      # steps/login_devices_steps.py:146
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 401                                              # steps/common_steps.py:116

  @school_search @security @pay_to_school @sasai
  Scenario: Verify search with malformed Bearer token                                    # features/pay_to_school/10_schoolSearch.feature:248
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                                  # steps/login_devices_steps.py:131
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 401                                              # steps/common_steps.py:116

  @school_search @error_handling @pay_to_school @sasai
  Scenario: Search with invalid HTTP method                                     # features/pay_to_school/10_schoolSearch.feature:258
    Given API is available                                                      # steps/common_steps.py:9
    And I am authenticated with valid app token                                 # steps/otp_steps.py:9
    And I have valid user token from PIN verification                           # steps/login_devices_steps.py:9
    Given I have valid user authentication                                      # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                             # steps/school_search_steps.py:21
    And I have page number 0                                                    # steps/school_search_steps.py:28
    And I have page size 10                                                     # steps/school_search_steps.py:35
    And I have name query "school"                                              # steps/school_search_steps.py:42
    When I send POST request to "/bff/v1/catalog/search-school-church-merchant" # steps/common_steps.py:28
    Then response status code should be 405                                     # steps/common_steps.py:116

  @school_search @error_handling @pay_to_school @sasai
  Scenario: Search with wrong endpoint path                    # features/pay_to_school/10_schoolSearch.feature:268
    Given API is available                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                # steps/otp_steps.py:9
    And I have valid user token from PIN verification          # steps/login_devices_steps.py:9
    Given I have valid user authentication                     # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                            # steps/school_search_steps.py:21
    And I have page number 0                                   # steps/school_search_steps.py:28
    And I have page size 10                                    # steps/school_search_steps.py:35
    And I have name query "school"                             # steps/school_search_steps.py:42
    When I send GET request to "/bff/v1/catalog/search-school" # steps/common_steps.py:50
    Then response status code should be 404                    # steps/common_steps.py:116

  @school_search @performance @pay_to_school @sasai
  Scenario: Verify search response time                                                  # features/pay_to_school/10_schoolSearch.feature:278
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response time should be less than 5000 ms                                        # steps/common_steps.py:169

  @school_search @integration @pay_to_school @sasai
  Scenario: Complete flow - PIN Verify to School Search                                                    # features/pay_to_school/10_schoolSearch.feature:289
    Given API is available                                                                                 # steps/common_steps.py:9
    And I am authenticated with valid app token                                                            # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                      # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                                            # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                                      # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                                # steps/common_steps.py:116
    And I store the user token from response                                                               # steps/login_devices_steps.py:260
    Given I have search type "SCHOOL"                                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                                               # steps/school_search_steps.py:28
    And I have page size 10                                                                                # steps/school_search_steps.py:35
    And I have name query "school"                                                                         # steps/school_search_steps.py:42
    When I send school search request with stored token to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:134
    Then response status code should be 200                                                                # steps/common_steps.py:116
    And response should contain search results                                                             # steps/school_search_steps.py:152

Feature: School Search by Code # features/pay_to_school/11_merchantLookupByCode.feature:1
  As a user
  I want to search for schools by merchant code
  So that I can get school/church/merchant details for payments
  Background:   # features/pay_to_school/11_merchantLookupByCode.feature:11

  @smoke @merchant_lookup_code @pay_to_school @sasai
  Scenario: Lookup merchant by valid code                                            # features/pay_to_school/11_merchantLookupByCode.feature:17
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172
    And response should have merchant information                                    # steps/merchant_lookup_code_steps.py:187

  @merchant_lookup_code @positive @pay_to_school @sasai
  Scenario: Lookup merchant by code returns correct structure                        # features/pay_to_school/11_merchantLookupByCode.feature:26
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response body should be valid JSON                                           # steps/common_steps.py:139
    And response should have merchant structure                                      # steps/merchant_lookup_code_steps.py:198

  @merchant_lookup_code @positive @pay_to_school @sasai
  Scenario: Lookup merchant with different valid code                                # features/pay_to_school/11_merchantLookupByCode.feature:35
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "149017"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172

  @merchant_lookup_code @positive @pay_to_school @sasai
  Scenario: Lookup merchant code with leading zeros                                  # features/pay_to_school/11_merchantLookupByCode.feature:43
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "0043"                                                  # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172

  @merchant_lookup_code @negative @pay_to_school @sasai
  Scenario: Lookup merchant without authentication                                   # features/pay_to_school/11_merchantLookupByCode.feature:51
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have no authentication token                                             # steps/login_devices_steps.py:100
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @merchant_lookup_code @negative @pay_to_school @sasai
  Scenario: Lookup merchant with invalid user token                                  # features/pay_to_school/11_merchantLookupByCode.feature:58
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have invalid user token                                                  # steps/login_devices_steps.py:123
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @merchant_lookup_code @negative @pay_to_school @sasai
  Scenario: Lookup merchant with expired user token                                  # features/pay_to_school/11_merchantLookupByCode.feature:65
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have expired user token                                                  # steps/login_devices_steps.py:115
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @merchant_lookup_code @negative @pay_to_school @sasai
  Scenario: Lookup merchant with app token instead of user token                     # features/pay_to_school/11_merchantLookupByCode.feature:72
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have app token only                                                      # steps/login_devices_steps.py:108
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401 or 403                                   # steps/common_steps.py:123

  @merchant_lookup_code @negative @pay_to_school @sasai
  Scenario: Lookup merchant with invalid merchant code                               # features/pay_to_school/11_merchantLookupByCode.feature:79
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "999999999"                                             # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 404                                          # steps/common_steps.py:116

  @merchant_lookup_code @negative @pay_to_school @sasai
  Scenario: Lookup merchant with empty merchant code                                 # features/pay_to_school/11_merchantLookupByCode.feature:86
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code ""/bff/v1/catalog/merchant-lookup                                                      # steps/merchant_lookup_code_steps.py:70
    When I send merchant lookup by code 400uest to "/bff/v1/catalog/merchant-lookup" # steps/common_steps.py:116
    Then response status code should be 400                                          # None

  @merchant_lookup_code @negative @pay_to_school @sasai
  Scenario: Lookup merchant without merchant code parameter                          # features/pay_to_school/11_merchantLookupByCode.feature:93
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have no merchant code                                                      # steps/merchant_lookup_code_steps.py:28
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400                                          # steps/common_steps.py:116

  @merchant_lookup_code @negative @pay_to_school @sasai
  Scenario: Lookup merchant with special characters in code                          # features/pay_to_school/11_merchantLookupByCode.feature:100
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054@329"                                               # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @merchant_lookup_code @negative @pay_to_school @sasai
  Scenario: Lookup merchant with alphabetic characters in code                       # features/pay_to_school/11_merchantLookupByCode.feature:107
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "ABC123"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @merchant_lookup_code @validation @pay_to_school @sasai
  Scenario: Verify merchant lookup response contains required fields                 # features/pay_to_school/11_merchantLookupByCode.feature:114
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And merchant response should have required fields                                # steps/merchant_lookup_code_steps.py:209
    And merchant response should contain name                                        # steps/merchant_lookup_code_steps.py:226
    And merchant response should contain code                                        # steps/merchant_lookup_code_steps.py:238
    And merchant response should contain mobile number                               # steps/merchant_lookup_code_steps.py:250

  @merchant_lookup_code @validation @pay_to_school @sasai
  Scenario: Verify merchant lookup response structure                                # features/pay_to_school/11_merchantLookupByCode.feature:125
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response body should be valid JSON                                           # steps/common_steps.py:139
    And response should have merchant structure                                      # steps/merchant_lookup_code_steps.py:198

  @merchant_lookup_code @headers @validation @pay_to_school @sasai
  Scenario: Verify merchant lookup response headers                                  # features/pay_to_school/11_merchantLookupByCode.feature:134
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response header "Content-Type" should be present                             # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"             # steps/common_steps.py:229

  @merchant_lookup_code @headers @validation @pay_to_school @sasai
  Scenario: Verify merchant lookup has required headers                              # features/pay_to_school/11_merchantLookupByCode.feature:143
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response header "Content-Type" should not be empty                           # steps/common_steps.py:243
    And response header "Date" should be present                                     # steps/common_steps.py:206

  @merchant_lookup_code @security @pay_to_school @sasai
  Scenario: Verify merchant lookup with missing Authorization header                 # features/pay_to_school/11_merchantLookupByCode.feature:152
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have no Authorization header                                             # steps/login_devices_steps.py:139
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @merchant_lookup_code @security @pay_to_school @sasai
  Scenario: Verify merchant lookup with empty Bearer token                           # features/pay_to_school/11_merchantLookupByCode.feature:159
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                                  # steps/login_devices_steps.py:146
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @merchant_lookup_code @security @pay_to_school @sasai
  Scenario: Verify merchant lookup with malformed Bearer token                       # features/pay_to_school/11_merchantLookupByCode.feature:166
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                              # steps/login_devices_steps.py:131
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @merchant_lookup_code @security @pay_to_school @sasai
  Scenario: Verify merchant lookup without Bearer prefix                             # features/pay_to_school/11_merchantLookupByCode.feature:173
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have token without Bearer prefix                                         # steps/login_devices_steps.py:154
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 401                                          # steps/common_steps.py:116

  @merchant_lookup_code @error_handling @pay_to_school @sasai
  Scenario: Merchant lookup with invalid HTTP method POST         # features/pay_to_school/11_merchantLookupByCode.feature:180
    Given API is available                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification             # steps/login_devices_steps.py:9
    Given I have valid user authentication                        # steps/login_devices_steps.py:92
    And I have merchant code "054329"                             # steps/merchant_lookup_code_steps.py:21
    When I send POST request to "/bff/v1/catalog/merchant-lookup" # steps/common_steps.py:28
    Then response status code should be 405                       # steps/common_steps.py:116

  @merchant_lookup_code @error_handling @pay_to_school @sasai
  Scenario: Merchant lookup with invalid HTTP method PUT         # features/pay_to_school/11_merchantLookupByCode.feature:187
    Given API is available                                       # steps/common_steps.py:9
    And I am authenticated with valid app token                  # steps/otp_steps.py:9
    And I have valid user token from PIN verification            # steps/login_devices_steps.py:9
    Given I have valid user authentication                       # steps/login_devices_steps.py:92
    And I have merchant code "054329"                            # steps/merchant_lookup_code_steps.py:21
    When I send PUT request to "/bff/v1/catalog/merchant-lookup" # steps/common_steps.py:70
    Then response status code should be 405                      # steps/common_steps.py:116

  @merchant_lookup_code @error_handling @pay_to_school @sasai
  Scenario: Merchant lookup with invalid HTTP method DELETE         # features/pay_to_school/11_merchantLookupByCode.feature:194
    Given API is available                                          # steps/common_steps.py:9
    And I am authenticated with valid app token                     # steps/otp_steps.py:9
    And I have valid user token from PIN verification               # steps/login_devices_steps.py:9
    Given I have valid user authentication                          # steps/login_devices_steps.py:92
    And I have merchant code "054329"                               # steps/merchant_lookup_code_steps.py:21
    When I send DELETE request to "/bff/v1/catalog/merchant-lookup" # steps/common_steps.py:92
    Then response status code should be 405                         # steps/common_steps.py:116

  @merchant_lookup_code @error_handling @pay_to_school @sasai
  Scenario: Merchant lookup with wrong endpoint path             # features/pay_to_school/11_merchantLookupByCode.feature:201
    Given API is available                                       # steps/common_steps.py:9
    And I am authenticated with valid app token                  # steps/otp_steps.py:9
    And I have valid user token from PIN verification            # steps/login_devices_steps.py:9
    Given I have valid user authentication                       # steps/login_devices_steps.py:92
    And I have merchant code "054329"                            # steps/merchant_lookup_code_steps.py:21
    When I send GET request to "/bff/v1/catalog/merchant-search" # steps/common_steps.py:50
    Then response status code should be 404                      # steps/common_steps.py:116

  @merchant_lookup_code @performance @pay_to_school @sasai
  Scenario: Verify merchant lookup response time                                     # features/pay_to_school/11_merchantLookupByCode.feature:208
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response time should be less than 3000 ms                                    # steps/common_steps.py:169

  @merchant_lookup_code @performance @pay_to_school @sasai
  Scenario: Verify merchant lookup response time is acceptable                       # features/pay_to_school/11_merchantLookupByCode.feature:216
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response time should be less than 5000 ms                                    # steps/common_steps.py:169

  @merchant_lookup_code @integration @pay_to_school @sasai
  Scenario: Complete flow - PIN Verify to Merchant Lookup by Code                                      # features/pay_to_school/11_merchantLookupByCode.feature:224
    Given API is available                                                                             # steps/common_steps.py:9
    And I am authenticated with valid app token                                                        # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                  # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                                        # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                                  # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                            # steps/common_steps.py:116
    And I store the user token from response                                                           # steps/login_devices_steps.py:260
    Given I have merchant code "054329"                                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request with stored token to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:127
    Then response status code should be 200                                                            # steps/common_steps.py:116
    And response should contain merchant details by code                                               # steps/merchant_lookup_code_steps.py:172

  @merchant_lookup_code @integration @pay_to_school @sasai
  Scenario: Search then lookup - School Search to Merchant Lookup by Code                                # features/pay_to_school/11_merchantLookupByCode.feature:235
    Given API is available                                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant"                 # steps/school_search_steps.py:73
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And response should contain search results                                                           # steps/school_search_steps.py:152
    And I extract first merchant code from search results                                                # steps/merchant_lookup_code_steps.py:528
    When I send merchant lookup by code request with extracted code to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:135
    Then response status code should be 200                                                              # steps/common_steps.py:116
    And response should contain merchant details by code                                                 # steps/merchant_lookup_code_steps.py:172

  @merchant_lookup_code @data_validation @pay_to_school @sasai
  Scenario: Verify merchant code matches in response                                 # features/pay_to_school/11_merchantLookupByCode.feature:250
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response merchant code should match requested code "054329"                  # steps/merchant_lookup_code_steps.py:262

  @merchant_lookup_code @data_validation @pay_to_school @sasai
  Scenario: Verify merchant name is not empty                                        # features/pay_to_school/11_merchantLookupByCode.feature:258
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And merchant name should not be empty                                            # steps/merchant_lookup_code_steps.py:276
    And merchant code should not be empty                                            # steps/merchant_lookup_code_steps.py:288

  @merchant_lookup_code @data_validation @pay_to_school @sasai
  Scenario: Verify merchant address information                                      # features/pay_to_school/11_merchantLookupByCode.feature:267
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And merchant should have address information                                     # steps/merchant_lookup_code_steps.py:300
    And merchant should have city information                                        # steps/merchant_lookup_code_steps.py:311

  @merchant_lookup_code @multiple_codes @pay_to_school @sasai
  Scenario Outline: Lookup different merchant codes -- @1.1                          # features/pay_to_school/11_merchantLookupByCode.feature:285
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172

  @merchant_lookup_code @multiple_codes @pay_to_school @sasai
  Scenario Outline: Lookup different merchant codes -- @1.2                          # features/pay_to_school/11_merchantLookupByCode.feature:286
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "149017"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172

  @merchant_lookup_code @multiple_codes @pay_to_school @sasai
  Scenario Outline: Lookup different merchant codes -- @1.3                          # features/pay_to_school/11_merchantLookupByCode.feature:287
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "164575"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172

  @merchant_lookup_code @multiple_codes @pay_to_school @sasai
  Scenario Outline: Lookup different merchant codes -- @1.4                          # features/pay_to_school/11_merchantLookupByCode.feature:288
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "123540"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172

  @merchant_lookup_code @multiple_codes @pay_to_school @sasai
  Scenario Outline: Lookup different merchant codes -- @1.5                          # features/pay_to_school/11_merchantLookupByCode.feature:289
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "0043"                                                  # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172

  @merchant_lookup_code @negative @multiple_codes @pay_to_school @sasai
  Scenario Outline: Lookup with invalid merchant codes -- @1.1                       # features/pay_to_school/11_merchantLookupByCode.feature:300
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "INVALID"                                               # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @merchant_lookup_code @negative @multiple_codes @pay_to_school @sasai
  Scenario Outline: Lookup with invalid merchant codes -- @1.2                       # features/pay_to_school/11_merchantLookupByCode.feature:301
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "99999999"                                              # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @merchant_lookup_code @negative @multiple_codes @pay_to_school @sasai
  Scenario Outline: Lookup with invalid merchant codes -- @1.3                       # features/pay_to_school/11_merchantLookupByCode.feature:302
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "-12345"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @merchant_lookup_code @negative @multiple_codes @pay_to_school @sasai
  Scenario Outline: Lookup with invalid merchant codes -- @1.4                       # features/pay_to_school/11_merchantLookupByCode.feature:303
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "@#$%^&"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 400 or 404                                   # steps/common_steps.py:123

  @merchant_lookup_code @case_sensitivity @pay_to_school @sasai
  Scenario: Verify merchant code is case insensitive (numeric)                       # features/pay_to_school/11_merchantLookupByCode.feature:306
    Given API is available                                                           # steps/common_steps.py:9
    And I am authenticated with valid app token                                      # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                # steps/login_devices_steps.py:9
    Given I have valid user authentication                                           # steps/login_devices_steps.py:92
    And I have merchant code "054329"                                                # steps/merchant_lookup_code_steps.py:21
    When I send merchant lookup by code request to "/bff/v1/catalog/merchant-lookup" # steps/merchant_lookup_code_steps.py:70
    Then response status code should be 200                                          # steps/common_steps.py:116
    And response should contain merchant details by code                             # steps/merchant_lookup_code_steps.py:172

Feature: School Payment Options # features/pay_to_school/12_schoolPaymentOptions.feature:1
  As a user
  I want to get available payment options for school payments
  So that I can choose how to pay for school/church/merchant services
  Background:   # features/pay_to_school/12_schoolPaymentOptions.feature:11

  @smoke @school_payment_options @pay_to_school @sasai
  Scenario: Get payment options for school payment                          # features/pay_to_school/12_schoolPaymentOptions.feature:17
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain payment options                             # steps/payment_options_steps.py:160
    And response should have payment instruments                            # steps/school_payment_options_steps.py:213

  @school_payment_options @positive @pay_to_school @sasai
  Scenario: Get payment options returns correct structure                   # features/pay_to_school/12_schoolPaymentOptions.feature:26
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response body should be valid JSON                                  # steps/common_steps.py:139
    And response should have payment options structure                      # steps/payment_options_steps.py:249

  @school_payment_options @positive @pay_to_school @sasai
  Scenario: Get payment options with device headers                         # features/pay_to_school/12_schoolPaymentOptions.feature:35
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device information headers                                   # steps/school_payment_options_steps.py:27
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain payment options                             # steps/payment_options_steps.py:160

  @school_payment_options @positive @pay_to_school @sasai
  Scenario: Get payment options includes wallet option                      # features/pay_to_school/12_schoolPaymentOptions.feature:44
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain wallet payment option                       # steps/school_payment_options_steps.py:235

  @school_payment_options @positive @pay_to_school @sasai
  Scenario: Get payment options with request ID                             # features/pay_to_school/12_schoolPaymentOptions.feature:52
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have request ID "43843e90-d1c8-11f0-a41e-95f35da604e5"            # steps/merchant_lookup_steps.py:94
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain payment options                             # steps/payment_options_steps.py:160

  @school_payment_options @negative @pay_to_school @sasai
  Scenario: Get payment options without authentication                      # features/pay_to_school/12_schoolPaymentOptions.feature:61
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have no authentication token                                    # steps/login_devices_steps.py:100
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 401                                 # steps/common_steps.py:116

  @school_payment_options @negative @pay_to_school @sasai
  Scenario: Get payment options with invalid user token                     # features/pay_to_school/12_schoolPaymentOptions.feature:68
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have invalid user token                                         # steps/login_devices_steps.py:123
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 401                                 # steps/common_steps.py:116

  @school_payment_options @negative @pay_to_school @sasai
  Scenario: Get payment options with expired user token                     # features/pay_to_school/12_schoolPaymentOptions.feature:75
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have expired user token                                         # steps/login_devices_steps.py:115
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 401                                 # steps/common_steps.py:116

  @school_payment_options @negative @pay_to_school @sasai
  Scenario: Get payment options with app token instead of user token        # features/pay_to_school/12_schoolPaymentOptions.feature:82
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have app token only                                             # steps/login_devices_steps.py:108
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 401 or 403                          # steps/common_steps.py:123

  @school_payment_options @negative @pay_to_school @sasai
  Scenario: Get payment options without service type                        # features/pay_to_school/12_schoolPaymentOptions.feature:89
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have no service type/bff/v2/payment/options                                              # steps/school_payment_options_steps.py:135
    When I send school payment options r400est to "/bff/v2/payment/options" # steps/common_steps.py:116
    Then response status code should be 400                                 # None

  @school_payment_options @negative @pay_to_school @sasai
  Scenario: Get payment options with invalid service type                   # features/pay_to_school/12_schoolPaymentOptions.feature:96
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "invalid-service-type"                          # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 400                                 # steps/common_steps.py:116

  @school_payment_options @negative @pay_to_school @sasai
  Scenario: Get payment options with empty service type                     # features/pay_to_school/12_schoolPaymentOptions.feature:103
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type ""/bff/v2/payment/options                                              # steps/school_payment_options_steps.py:135
    When I send school payment options r400est to "/bff/v2/payment/options" # steps/common_steps.py:116
    Then response status code should be 400                                 # None

  @school_payment_options @validation @pay_to_school @sasai
  Scenario: Verify payment options response contains required fields        # features/pay_to_school/12_schoolPaymentOptions.feature:110
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And payment options response should have items                          # steps/school_payment_options_steps.py:252
    And payment options response should have instruments                    # steps/school_payment_options_steps.py:264

  @school_payment_options @validation @pay_to_school @sasai
  Scenario: Verify payment options instruments have required details        # features/pay_to_school/12_schoolPaymentOptions.feature:119
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And payment instruments should have instrument tokens                   # steps/school_payment_options_steps.py:281
    And payment instruments should have provider information                # steps/school_payment_options_steps.py:303

  @school_payment_options @validation @pay_to_school @sasai
  Scenario: Verify payment options response structure                       # features/pay_to_school/12_schoolPaymentOptions.feature:128
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response body should be valid JSON                                  # steps/common_steps.py:139
    And response should have payment options structure                      # steps/payment_options_steps.py:249

  @school_payment_options @headers @validation @pay_to_school @sasai
  Scenario: Verify payment options response headers                         # features/pay_to_school/12_schoolPaymentOptions.feature:137
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response header "Content-Type" should be present                    # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"    # steps/common_steps.py:229

  @school_payment_options @headers @validation @pay_to_school @sasai
  Scenario: Verify payment options with all device headers                  # features/pay_to_school/12_schoolPaymentOptions.feature:146
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have all required device headers                                  # steps/school_payment_options_steps.py:44
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain payment options                             # steps/payment_options_steps.py:160

  @school_payment_options @security @pay_to_school @sasai
  Scenario: Verify payment options with missing Authorization header        # features/pay_to_school/12_schoolPaymentOptions.feature:155
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have no Authorization header                                    # steps/login_devices_steps.py:139
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 401                                 # steps/common_steps.py:116

  @school_payment_options @security @pay_to_school @sasai
  Scenario: Verify payment options with empty Bearer token                  # features/pay_to_school/12_schoolPaymentOptions.feature:162
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                         # steps/login_devices_steps.py:146
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 401                                 # steps/common_steps.py:116

  @school_payment_options @security @pay_to_school @sasai
  Scenario: Verify payment options with malformed Bearer token              # features/pay_to_school/12_schoolPaymentOptions.feature:169
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                     # steps/login_devices_steps.py:131
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 401                                 # steps/common_steps.py:116

  @school_payment_options @security @pay_to_school @sasai
  Scenario: Verify payment options without Bearer prefix                    # features/pay_to_school/12_schoolPaymentOptions.feature:176
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have token without Bearer prefix                                # steps/login_devices_steps.py:154
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 401                                 # steps/common_steps.py:116

  @school_payment_options @error_handling @pay_to_school @sasai
  Scenario: Payment options with invalid HTTP method POST  # features/pay_to_school/12_schoolPaymentOptions.feature:183
    Given API is available                                 # steps/common_steps.py:9
    And I am authenticated with valid app token            # steps/otp_steps.py:9
    And I have valid user token from PIN verification      # steps/login_devices_steps.py:9
    Given I have valid user authentication                 # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"            # steps/payment_options_steps.py:16
    When I send POST request to "/bff/v2/payment/options"  # steps/common_steps.py:28
    Then response status code should be 405                # steps/common_steps.py:116

  @school_payment_options @error_handling @pay_to_school @sasai
  Scenario: Payment options with invalid HTTP method PUT  # features/pay_to_school/12_schoolPaymentOptions.feature:190
    Given API is available                                # steps/common_steps.py:9
    And I am authenticated with valid app token           # steps/otp_steps.py:9
    And I have valid user token from PIN verification     # steps/login_devices_steps.py:9
    Given I have valid user authentication                # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"           # steps/payment_options_steps.py:16
    When I send PUT request to "/bff/v2/payment/options"  # steps/common_steps.py:70
    Then response status code should be 405               # steps/common_steps.py:116

  @school_payment_options @error_handling @pay_to_school @sasai
  Scenario: Payment options with invalid HTTP method DELETE  # features/pay_to_school/12_schoolPaymentOptions.feature:197
    Given API is available                                   # steps/common_steps.py:9
    And I am authenticated with valid app token              # steps/otp_steps.py:9
    And I have valid user token from PIN verification        # steps/login_devices_steps.py:9
    Given I have valid user authentication                   # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"              # steps/payment_options_steps.py:16
    When I send DELETE request to "/bff/v2/payment/options"  # steps/common_steps.py:92
    Then response status code should be 405                  # steps/common_steps.py:116

  @school_payment_options @error_handling @pay_to_school @sasai
  Scenario: Payment options with wrong endpoint path    # features/pay_to_school/12_schoolPaymentOptions.feature:204
    Given API is available                              # steps/common_steps.py:9
    And I am authenticated with valid app token         # steps/otp_steps.py:9
    And I have valid user token from PIN verification   # steps/login_devices_steps.py:9
    Given I have valid user authentication              # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"         # steps/payment_options_steps.py:16
    When I send GET request to "/bff/v2/payment/option" # steps/common_steps.py:50
    Then response status code should be 404             # steps/common_steps.py:116

  @school_payment_options @performance @pay_to_school @sasai
  Scenario: Verify payment options response time                            # features/pay_to_school/12_schoolPaymentOptions.feature:211
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response time should be less than 3000 ms                           # steps/common_steps.py:169

  @school_payment_options @performance @pay_to_school @sasai
  Scenario: Verify payment options response time is acceptable              # features/pay_to_school/12_schoolPaymentOptions.feature:219
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response time should be less than 5000 ms                           # steps/common_steps.py:169

  @school_payment_options @integration @pay_to_school @sasai
  Scenario: Complete flow - PIN Verify to Payment Options                                     # features/pay_to_school/12_schoolPaymentOptions.feature:227
    Given API is available                                                                    # steps/common_steps.py:9
    And I am authenticated with valid app token                                               # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                         # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                               # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                         # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                   # steps/common_steps.py:116
    And I store the user token from response                                                  # steps/login_devices_steps.py:260
    Given I have service type "sasai-app-payment"                                             # steps/payment_options_steps.py:16
    When I send school payment options request with stored token to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:196
    Then response status code should be 200                                                   # steps/common_steps.py:116
    And response should contain payment options                                               # steps/payment_options_steps.py:160

  @school_payment_options @integration @pay_to_school @sasai
  Scenario: Complete flow - School Search to Payment Options                             # features/pay_to_school/12_schoolPaymentOptions.feature:238
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152
    Given I have service type "sasai-app-payment"                                        # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options"              # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain payment options                                          # steps/payment_options_steps.py:160
    And payment instruments should have instrument tokens                                # steps/school_payment_options_steps.py:281

  @school_payment_options @data_validation @pay_to_school @sasai
  Scenario: Verify instrument tokens are not empty                          # features/pay_to_school/12_schoolPaymentOptions.feature:254
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And all instrument tokens should not be empty                           # steps/school_payment_options_steps.py:320

  @school_payment_options @data_validation @pay_to_school @sasai
  Scenario: Verify payment options contains EcoCash provider                # features/pay_to_school/12_schoolPaymentOptions.feature:262
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And payment options should contain provider "ecocash"                   # steps/school_payment_options_steps.py:341

  @school_payment_options @data_validation @pay_to_school @sasai
  Scenario: Verify payment instruments have currency information            # features/pay_to_school/12_schoolPaymentOptions.feature:270
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And payment instruments should have currency information                # steps/school_payment_options_steps.py:363

  @school_payment_options @data_validation @pay_to_school @sasai
  Scenario: Verify default payment instrument is marked                     # features/pay_to_school/12_schoolPaymentOptions.feature:278
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should have default payment instrument                     # steps/school_payment_options_steps.py:385

  @school_payment_options @service_types @pay_to_school @sasai
  Scenario Outline: Get payment options with different service types -- @1.1   # features/pay_to_school/12_schoolPaymentOptions.feature:294
    Given API is available                                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                                # steps/otp_steps.py:9
    And I have valid user token from PIN verification                          # steps/login_devices_steps.py:9
    Given I have valid user authentication                                     # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                                # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options"    # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                    # steps/common_steps.py:116

  @school_payment_options @service_types @pay_to_school @sasai
  Scenario Outline: Get payment options with different service types -- @1.2   # features/pay_to_school/12_schoolPaymentOptions.feature:295
    Given API is available                                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                                # steps/otp_steps.py:9
    And I have valid user token from PIN verification                          # steps/login_devices_steps.py:9
    Given I have valid user authentication                                     # steps/login_devices_steps.py:92
    And I have service type "sasai-super-app"                                  # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options"    # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                    # steps/common_steps.py:116

  @school_payment_options @service_types @pay_to_school @sasai
  Scenario Outline: Get payment options with different service types -- @1.3   # features/pay_to_school/12_schoolPaymentOptions.feature:296
    Given API is available                                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                                # steps/otp_steps.py:9
    And I have valid user token from PIN verification                          # steps/login_devices_steps.py:9
    Given I have valid user authentication                                     # steps/login_devices_steps.py:92
    And I have service type "merchant-payment"                                 # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options"    # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                    # steps/common_steps.py:116

  @school_payment_options @device_headers @pay_to_school @sasai
  Scenario: Payment options with Android device headers                     # features/pay_to_school/12_schoolPaymentOptions.feature:299
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have device type "android"                                        # steps/school_payment_options_steps.py:71
    And I have OS version "15"                                              # steps/school_payment_options_steps.py:80
    And I have app version "2.2.1"                                          # steps/school_payment_options_steps.py:89
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain payment options                             # steps/payment_options_steps.py:160

  @school_payment_options @device_headers @pay_to_school @sasai
  Scenario: Payment options with location headers                           # features/pay_to_school/12_schoolPaymentOptions.feature:310
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    And I have latitude "28.508632"                                         # steps/school_payment_options_steps.py:98
    And I have longitude "77.092242"                                        # steps/school_payment_options_steps.py:107
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain payment options                             # steps/payment_options_steps.py:160

  @school_payment_options @wallet_details @pay_to_school @sasai
  Scenario: Verify wallet details in payment options                        # features/pay_to_school/12_schoolPaymentOptions.feature:320
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And payment options should contain wallet details                       # steps/school_payment_options_steps.py:477
    And wallet details should have masked account number                    # steps/school_payment_options_steps.py:499

  @school_payment_options @extract_token @pay_to_school @sasai
  Scenario: Extract instrument token for payment                            # features/pay_to_school/12_schoolPaymentOptions.feature:329
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And I extract instrument token from response                            # steps/school_payment_options_steps.py:527
    And instrument token should be valid format                             # steps/school_payment_options_steps.py:547

  @school_payment_options @cache @pay_to_school @sasai
  Scenario: Verify payment options can be called multiple times             # features/pay_to_school/12_schoolPaymentOptions.feature:338
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain payment options                             # steps/payment_options_steps.py:160
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should contain payment options                             # steps/payment_options_steps.py:160

  @school_payment_options @payment_menu @pay_to_school @sasai
  Scenario: Verify payment menu in response                                 # features/pay_to_school/12_schoolPaymentOptions.feature:349
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And response should have payment menu                                   # steps/school_payment_options_steps.py:407

  @school_payment_options @providers @pay_to_school @sasai
  Scenario: Verify payment providers information                            # features/pay_to_school/12_schoolPaymentOptions.feature:357
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And payment options should have providers list                          # steps/school_payment_options_steps.py:416
    And providers should have health check status                           # steps/school_payment_options_steps.py:433

  @school_payment_options @balance_enquiry @pay_to_school @sasai
  Scenario: Verify balance enquiry capability in payment options            # features/pay_to_school/12_schoolPaymentOptions.feature:366
    Given API is available                                                  # steps/common_steps.py:9
    And I am authenticated with valid app token                             # steps/otp_steps.py:9
    And I have valid user token from PIN verification                       # steps/login_devices_steps.py:9
    Given I have valid user authentication                                  # steps/login_devices_steps.py:92
    And I have service type "sasai-app-payment"                             # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                 # steps/common_steps.py:116
    And payment providers should support balance enquiry                    # steps/school_payment_options_steps.py:455

Feature: School Payment # features/pay_to_school/13_schoolPayment.feature:1
  As a user
  I want to make payments to schools
  So that I can pay school fees and related charges
  Background:   # features/pay_to_school/13_schoolPayment.feature:12

  @smoke @school_payment @pay_to_school @sasai
  Scenario: Process school payment with valid details                     # features/pay_to_school/13_schoolPayment.feature:18
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351
    And response should have transaction reference                        # steps/school_payment_steps.py:383

  @school_payment @positive @pay_to_school @sasai
  Scenario: Process school payment returns correct structure              # features/pay_to_school/13_schoolPayment.feature:30
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response body should be valid JSON                                # steps/common_steps.py:139
    And response should have payment structure                            # steps/church_payment_steps.py:398

  @school_payment @positive @pay_to_school @sasai
  Scenario: Process school payment with student reference                 # features/pay_to_school/13_schoolPayment.feature:42
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have student reference "John Doe"                               # steps/school_payment_steps.py:111
    And I have payment amount 5.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @positive @pay_to_school @sasai
  Scenario: Process school payment with different amount                  # features/pay_to_school/13_schoolPayment.feature:54
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 10.0                                        # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @positive @pay_to_school @sasai
  Scenario: Process school payment with device information                # features/pay_to_school/13_schoolPayment.feature:65
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details with device info                    # steps/school_payment_steps.py:73
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment without authentication                 # features/pay_to_school/13_schoolPayment.feature:76
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have no authentication token                                  # steps/login_devices_steps.py:100
    And I have school payment details                                     # steps/school_payment_steps.py:28
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 401                               # steps/common_steps.py:116

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment with invalid user token                # features/pay_to_school/13_schoolPayment.feature:83
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have invalid user token                                       # steps/login_devices_steps.py:123
    And I have school payment details                                     # steps/school_payment_steps.py:28
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 401                               # steps/common_steps.py:116

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment with expired user token                # features/pay_to_school/13_schoolPayment.feature:90
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have expired user token                                       # steps/login_devices_steps.py:115
    And I have school payment details                                     # steps/school_payment_steps.py:28
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 401                               # steps/common_steps.py:116

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment with app token instead of user token   # features/pay_to_school/13_schoolPayment.feature:97
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have app token only                                           # steps/login_devices_steps.py:108
    And I have school payment details                                     # steps/school_payment_steps.py:28
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 401 or 403                        # steps/common_steps.py:123

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment without instrument token               # features/pay_to_school/13_schoolPayment.feature:104
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have school payment details without instrument token            # steps/school_payment_steps.py:141
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 400                               # steps/common_steps.py:116

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment with invalid instrument token          # features/pay_to_school/13_schoolPayment.feature:111
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have invalid instrument token                                   # steps/school_payment_steps.py:132
    And I have school payment details                                     # steps/school_payment_steps.py:28
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 400 or 404                        # steps/common_steps.py:123

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment without payment amount                 # features/pay_to_school/13_schoolPayment.feature:119
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details without amount                      # steps/school_payment_steps.py:149
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 400                               # steps/common_steps.py:116

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment with zero amount                       # features/pay_to_school/13_schoolPayment.feature:127
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have payment amount 0                                           # steps/school_payment_steps.py:104
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 400                               # steps/common_steps.py:116

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment with negative amount                   # features/pay_to_school/13_schoolPayment.feature:136
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have payment amount -5.0                                        # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 400                               # steps/common_steps.py:116

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment without biller details                 # features/pay_to_school/13_schoolPayment.feature:145
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details without biller                      # steps/school_payment_steps.py:158
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 400                               # steps/common_steps.py:116

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment with invalid school code               # features/pay_to_school/13_schoolPayment.feature:153
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "9999999"                  # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 400 or 404                        # steps/common_steps.py:123

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment without currency                       # features/pay_to_school/13_schoolPayment.feature:163
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details without currency                    # steps/school_payment_steps.py:166
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 400                               # steps/common_steps.py:116

  @school_payment @negative @pay_to_school @sasai
  Scenario: Process school payment with invalid currency                  # features/pay_to_school/13_schoolPayment.feature:171
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details with currency "INVALID"             # steps/school_payment_steps.py:175
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 400                               # steps/common_steps.py:116

  @school_payment @validation @pay_to_school @sasai
  Scenario: Verify school payment response contains required fields       # features/pay_to_school/13_schoolPayment.feature:179
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And payment response should have status                               # steps/school_payment_steps.py:397
    And payment response should have transaction ID                       # steps/school_payment_steps.py:422
    And payment response should have reference number                     # steps/school_payment_steps.py:408

  @school_payment @validation @pay_to_school @sasai
  Scenario: Verify school payment response structure                      # features/pay_to_school/13_schoolPayment.feature:192
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response body should be valid JSON                                # steps/common_steps.py:139
    And response should have payment structure                            # steps/church_payment_steps.py:398

  @school_payment @headers @validation @pay_to_school @sasai
  Scenario: Verify school payment response headers                        # features/pay_to_school/13_schoolPayment.feature:204
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response header "Content-Type" should be present                  # steps/common_steps.py:206
    And response header "Content-Type" should contain "application/json"  # steps/common_steps.py:229

  @school_payment @security @pay_to_school @sasai
  Scenario: Verify school payment with missing Authorization header       # features/pay_to_school/13_schoolPayment.feature:216
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have no Authorization header                                  # steps/login_devices_steps.py:139
    And I have school payment details                                     # steps/school_payment_steps.py:28
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 401                               # steps/common_steps.py:116

  @school_payment @security @pay_to_school @sasai
  Scenario: Verify school payment with empty Bearer token                 # features/pay_to_school/13_schoolPayment.feature:223
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have empty Bearer token                                       # steps/login_devices_steps.py:146
    And I have school payment details                                     # steps/school_payment_steps.py:28
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 401                               # steps/common_steps.py:116

  @school_payment @security @pay_to_school @sasai
  Scenario: Verify school payment with malformed Bearer token             # features/pay_to_school/13_schoolPayment.feature:230
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have malformed Bearer token                                   # steps/login_devices_steps.py:131
    And I have school payment details                                     # steps/school_payment_steps.py:28
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 401                               # steps/common_steps.py:116

  @school_payment @error_handling @pay_to_school @sasai
  Scenario: School payment with invalid HTTP method GET        # features/pay_to_school/13_schoolPayment.feature:237
    Given API is available                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                # steps/otp_steps.py:9
    And I have valid user token from PIN verification          # steps/login_devices_steps.py:9
    Given I have valid user authentication                     # steps/login_devices_steps.py:92
    When I send GET request to "/bff/v2/order/utility/payment" # steps/common_steps.py:50
    Then response status code should be 405                    # steps/common_steps.py:116

  @school_payment @error_handling @pay_to_school @sasai
  Scenario: School payment with invalid HTTP method PUT        # features/pay_to_school/13_schoolPayment.feature:243
    Given API is available                                     # steps/common_steps.py:9
    And I am authenticated with valid app token                # steps/otp_steps.py:9
    And I have valid user token from PIN verification          # steps/login_devices_steps.py:9
    Given I have valid user authentication                     # steps/login_devices_steps.py:92
    When I send PUT request to "/bff/v2/order/utility/payment" # steps/common_steps.py:70
    Then response status code should be 405                    # steps/common_steps.py:116

  @school_payment @error_handling @pay_to_school @sasai
  Scenario: School payment with invalid HTTP method DELETE        # features/pay_to_school/13_schoolPayment.feature:249
    Given API is available                                        # steps/common_steps.py:9
    And I am authenticated with valid app token                   # steps/otp_steps.py:9
    And I have valid user token from PIN verification             # steps/login_devices_steps.py:9
    Given I have valid user authentication                        # steps/login_devices_steps.py:92
    When I send DELETE request to "/bff/v2/order/utility/payment" # steps/common_steps.py:92
    Then response status code should be 405                       # steps/common_steps.py:116

  @school_payment @error_handling @pay_to_school @sasai
  Scenario: School payment with wrong endpoint path              # features/pay_to_school/13_schoolPayment.feature:255
    Given API is available                                       # steps/common_steps.py:9
    And I am authenticated with valid app token                  # steps/otp_steps.py:9
    And I have valid user token from PIN verification            # steps/login_devices_steps.py:9
    Given I have valid user authentication                       # steps/login_devices_steps.py:92
    And I have school payment details                            # steps/school_payment_steps.py:28
    When I send POST request to "/bff/v2/order/utility/payments" # steps/common_steps.py:28
    Then response status code should be 404                      # steps/common_steps.py:116

  @school_payment @performance @pay_to_school @sasai
  Scenario: Verify school payment response time                           # features/pay_to_school/13_schoolPayment.feature:262
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response time should be less than 5000 ms                         # steps/common_steps.py:169

  @school_payment @performance @pay_to_school @sasai
  Scenario: Verify school payment response time is acceptable             # features/pay_to_school/13_schoolPayment.feature:273
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response time should be less than 10000 ms                        # steps/common_steps.py:169

  @school_payment @integration @pay_to_school @sasai
  Scenario: Complete flow - PIN Verify to School Payment                                      # features/pay_to_school/13_schoolPayment.feature:284
    Given API is available                                                                    # steps/common_steps.py:9
    And I am authenticated with valid app token                                               # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                         # steps/login_devices_steps.py:9
    Given I have valid PIN verification details                                               # steps/pin_verify_steps.py:10
    When I send PIN verification request to "/bff/v4/auth/pin/verify"                         # steps/pin_verify_steps.py:222
    Then response status code should be 200                                                   # steps/common_steps.py:116
    And I store the user token from response                                                  # steps/login_devices_steps.py:260
    Given I have service type "sasai-app-payment"                                             # steps/payment_options_steps.py:16
    When I send school payment options request with stored token to "/bff/v2/payment/options" # steps/school_payment_options_steps.py:196
    Then response status code should be 200                                                   # steps/common_steps.py:116
    And I extract instrument token from response                                              # steps/school_payment_options_steps.py:527
    Given I have school payment details with extracted token                                  # steps/school_payment_steps.py:260
    And I have biller details with school code "054329"                                       # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                                             # steps/school_payment_steps.py:92
    When I send school payment request with stored token to "/bff/v2/order/utility/payment"   # steps/school_payment_steps.py:364
    Then response status code should be 200                                                   # steps/common_steps.py:116
    And response should contain payment confirmation                                          # steps/church_payment_steps.py:351

  @school_payment @integration @pay_to_school @sasai
  Scenario: Complete flow - Search School, Get Options, Make Payment                     # features/pay_to_school/13_schoolPayment.feature:301
    Given API is available                                                               # steps/common_steps.py:9
    And I am authenticated with valid app token                                          # steps/otp_steps.py:9
    And I have valid user token from PIN verification                                    # steps/login_devices_steps.py:9
    Given I have valid user authentication                                               # steps/login_devices_steps.py:92
    And I have search type "SCHOOL"                                                      # steps/school_search_steps.py:21
    And I have page number 0                                                             # steps/school_search_steps.py:28
    And I have page size 10                                                              # steps/school_search_steps.py:35
    And I have name query "school"                                                       # steps/school_search_steps.py:42
    When I send school search request to "/bff/v1/catalog/search-school-church-merchant" # steps/school_search_steps.py:73
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain search results                                           # steps/school_search_steps.py:152
    And I extract first merchant code from search results                                # steps/merchant_lookup_code_steps.py:528
    Given I have service type "sasai-app-payment"                                        # steps/payment_options_steps.py:16
    When I send school payment options request to "/bff/v2/payment/options"              # steps/school_payment_options_steps.py:135
    Then response status code should be 200                                              # steps/common_steps.py:116
    And I extract instrument token from response                                         # steps/school_payment_options_steps.py:527
    Given I have school payment details with extracted token and code                    # steps/school_payment_steps.py:269
    And I have payment amount 2.0                                                        # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment"                # steps/school_payment_steps.py:304
    Then response status code should be 200                                              # steps/common_steps.py:116
    And response should contain payment confirmation                                     # steps/church_payment_steps.py:351

  @school_payment @data_validation @pay_to_school @sasai
  Scenario: Verify payment confirmation status                            # features/pay_to_school/13_schoolPayment.feature:322
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And payment status should be success or pending                       # steps/school_payment_steps.py:436

  @school_payment @data_validation @pay_to_school @sasai
  Scenario: Verify payment amount in response                             # features/pay_to_school/13_schoolPayment.feature:333
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And payment response should contain amount 2.0                        # steps/school_payment_steps.py:452

  @school_payment @data_validation @pay_to_school @sasai
  Scenario: Verify school details in payment response                     # features/pay_to_school/13_schoolPayment.feature:344
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have school name "PRINCE EDWARD HIGH SCHOOL"                    # steps/school_payment_steps.py:121
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain school details                            # steps/school_payment_steps.py:474

  @school_payment @device_info @pay_to_school @sasai
  Scenario: School payment with complete device information               # features/pay_to_school/13_schoolPayment.feature:356
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have complete device information                                # steps/school_payment_steps.py:199
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @notes @pay_to_school @sasai
  Scenario: School payment with custom notes                              # features/pay_to_school/13_schoolPayment.feature:368
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment notes with student info                            # steps/school_payment_steps.py:209
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @currency @pay_to_school @sasai
  Scenario Outline: School payment with different currencies -- @1.1      # features/pay_to_school/13_schoolPayment.feature:391
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details with currency "USD"                 # steps/school_payment_steps.py:175
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116

  @school_payment @currency @pay_to_school @sasai
  Scenario Outline: School payment with different currencies -- @1.2      # features/pay_to_school/13_schoolPayment.feature:392
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details with currency "ZWG"                 # steps/school_payment_steps.py:175
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116

  @school_payment @amounts @pay_to_school @sasai
  Scenario Outline: School payment with different amounts -- @1.1         # features/pay_to_school/13_schoolPayment.feature:407
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 1.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @amounts @pay_to_school @sasai
  Scenario Outline: School payment with different amounts -- @1.2         # features/pay_to_school/13_schoolPayment.feature:408
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @amounts @pay_to_school @sasai
  Scenario Outline: School payment with different amounts -- @1.3         # features/pay_to_school/13_schoolPayment.feature:409
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 5.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @amounts @pay_to_school @sasai
  Scenario Outline: School payment with different amounts -- @1.4         # features/pay_to_school/13_schoolPayment.feature:410
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 10.0                                        # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @amounts @pay_to_school @sasai
  Scenario Outline: School payment with different amounts -- @1.5         # features/pay_to_school/13_schoolPayment.feature:411
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 20.0                                        # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @amounts @pay_to_school @sasai
  Scenario Outline: School payment with different amounts -- @1.6         # features/pay_to_school/13_schoolPayment.feature:412
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 50.0                                        # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @operators @pay_to_school @sasai
  Scenario: School payment with operator and category IDs                 # features/pay_to_school/13_schoolPayment.feature:415
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have operator ID "SZWOSL0001"                                   # steps/merchant_lookup_steps.py:52
    And I have category ID "SZWC10017"                                    # steps/school_payment_steps.py:189
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @pin_encryption @pay_to_school @sasai
  Scenario: School payment with encrypted PIN                             # features/pay_to_school/13_schoolPayment.feature:428
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details with encrypted PIN                  # steps/school_payment_steps.py:219
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @provider @pay_to_school @sasai
  Scenario: School payment with EcoCash provider                          # features/pay_to_school/13_schoolPayment.feature:439
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details with provider "ecocash"             # steps/school_payment_steps.py:227
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @channel @pay_to_school @sasai
  Scenario: School payment with Sasai super app channel                   # features/pay_to_school/13_schoolPayment.feature:450
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details with channel "sasai-super-app"      # steps/school_payment_steps.py:235
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @subtype @pay_to_school @sasai
  Scenario: School payment with pay-to-school subtype                     # features/pay_to_school/13_schoolPayment.feature:461
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details with subtype "pay-to-school"        # steps/school_payment_steps.py:243
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should contain payment confirmation                      # steps/church_payment_steps.py:351

  @school_payment @idempotency @pay_to_school @sasai
  Scenario: School payment idempotency check                              # features/pay_to_school/13_schoolPayment.feature:472
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details with unique request ID              # steps/school_payment_steps.py:251
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And I store the transaction reference                                 # steps/school_payment_steps.py:493
    When I send the same school payment request again                     # steps/school_payment_steps.py:372
    Then response status code should be 200 or 409                        # steps/common_steps.py:123

  @school_payment @receipt @pay_to_school @sasai
  Scenario: School payment generates receipt data                         # features/pay_to_school/13_schoolPayment.feature:485
    Given API is available                                                # steps/common_steps.py:9
    And I am authenticated with valid app token                           # steps/otp_steps.py:9
    And I have valid user token from PIN verification                     # steps/login_devices_steps.py:9
    Given I have valid user authentication                                # steps/login_devices_steps.py:92
    And I have instrument token from payment options                      # steps/school_payment_steps.py:19
    And I have school payment details                                     # steps/school_payment_steps.py:28
    And I have biller details with school code "054329"                   # steps/school_payment_steps.py:81
    And I have payment amount 2.0                                         # steps/school_payment_steps.py:92
    When I send school payment request to "/bff/v2/order/utility/payment" # steps/school_payment_steps.py:304
    Then response status code should be 200                               # steps/common_steps.py:116
    And response should have receipt information                          # steps/school_payment_steps.py:509

